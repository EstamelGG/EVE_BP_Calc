var e=Object.defineProperty,t=(t,a,s)=>((t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s)(t,"symbol"!=typeof a?a+"":a,s);import{r as a,d as s,R as r}from"./vendor-DwZn5VZs.js";import{I as n,R as i,a as c}from"./antd-BIkeXNmn.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var l={exports:{}},o={},u=a,d=Symbol.for("react.element"),m=Symbol.for("react.fragment"),h=Object.prototype.hasOwnProperty,p=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,y={key:!0,ref:!0,__self:!0,__source:!0};function f(e,t,a){var s,r={},n=null,i=null;for(s in void 0!==a&&(n=""+a),void 0!==t.key&&(n=""+t.key),void 0!==t.ref&&(i=t.ref),t)h.call(t,s)&&!y.hasOwnProperty(s)&&(r[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===r[s]&&(r[s]=t[s]);return{$$typeof:d,type:e,key:n,ref:i,props:r,_owner:p.current}}o.Fragment=m,o.jsx=f,o.jsxs=f,l.exports=o;var v=l.exports,g={},x=s;g.createRoot=x.createRoot,g.hydrateRoot=x.hydrateRoot;const S={},j=function(e,t,a){let s=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),n=(null==r?void 0:r.nonce)||(null==r?void 0:r.getAttribute("nonce"));s=Promise.allSettled(t.map(t=>{if(t=function(e,t){return new URL(e,t).href}(t,a),t in S)return;S[t]=!0;const s=t.endsWith(".css"),r=s?'[rel="stylesheet"]':"";if(!!a)for(let a=e.length-1;a>=0;a--){const r=e[a];if(r.href===t&&(!s||"stylesheet"===r.rel))return}else if(document.querySelector(`link[href="${t}"]${r}`))return;const i=document.createElement("link");return i.rel=s?"stylesheet":"modulepreload",s||(i.as="script"),i.crossOrigin="",i.href=t,n&&i.setAttribute("nonce",n),document.head.appendChild(i),s?new Promise((e,a)=>{i.addEventListener("load",e),i.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)})};const N=new class{constructor(){t(this,"cache",{}),t(this,"maxConcurrentLoads",5),t(this,"currentLoads",0),t(this,"maxCacheSize",500)}async loadIcon(e){var t,a;return this.checkAndCleanCache(),(null==(t=this.cache[e])?void 0:t.loaded)?(this.cache[e].lastUsed=Date.now(),this.cache[e].useCount++,this.cache[e].src):(null==(a=this.cache[e])?void 0:a.loading)?new Promise(t=>{const a=()=>{var s,r;(null==(s=this.cache[e])?void 0:s.loaded)?(this.cache[e].lastUsed=Date.now(),this.cache[e].useCount++,t(this.cache[e].src)):(null==(r=this.cache[e])?void 0:r.error)?t("./vite.svg"):setTimeout(a,50)};a()}):(this.cache[e]={src:e,loading:!0,loaded:!1,error:!1,lastUsed:Date.now(),useCount:1},this.currentLoads>=this.maxConcurrentLoads?new Promise(t=>{const a=()=>{this.currentLoads<this.maxConcurrentLoads?(this.currentLoads++,this.loadIconInternal(e).then(t)):setTimeout(a,100)};a()}):(this.currentLoads++,this.loadIconInternal(e)))}async loadIconInternal(e){var t;try{const t=new Image;return await new Promise(a=>{t.onload=()=>{var t;this.cache[e]={src:e,loading:!1,loaded:!0,error:!1,lastUsed:Date.now(),useCount:(null==(t=this.cache[e])?void 0:t.useCount)||1},this.currentLoads--,a(e)},t.onerror=()=>{var t;this.cache[e]={src:"./vite.svg",loading:!1,loaded:!0,error:!0,lastUsed:Date.now(),useCount:(null==(t=this.cache[e])?void 0:t.useCount)||1},this.currentLoads--,a("./vite.svg")},t.src=e})}catch(a){return this.cache[e]={src:"./vite.svg",loading:!1,loaded:!0,error:!0,lastUsed:Date.now(),useCount:(null==(t=this.cache[e])?void 0:t.useCount)||1},this.currentLoads--,"./vite.svg"}}preloadIcons(e){e.forEach(e=>{this.cache[e]||this.loadIcon(e).catch(()=>{})})}getIconStatus(e){const t=this.cache[e];return t?{loading:t.loading,loaded:t.loaded,error:t.error}:{loading:!1,loaded:!1,error:!1}}clearCache(){this.cache={}}checkAndCleanCache(){const e=Object.keys(this.cache).length;if(e<=this.maxCacheSize)return;const t=Object.entries(this.cache).map(([e,t])=>({path:e,item:t,score:this.calculateCacheScore(t)}));t.sort((e,t)=>e.score-t.score);const a=e-this.maxCacheSize;t.slice(0,a).forEach(({path:e})=>{delete this.cache[e]})}calculateCacheScore(e){const t=(Date.now()-e.lastUsed)/36e5;return 10*e.useCount-t}getCacheStats(){const e=Object.values(this.cache);return{total:e.length,loaded:e.filter(e=>e.loaded&&!e.error).length,loading:e.filter(e=>e.loading).length,error:e.filter(e=>e.error).length}}forceCacheCleanup(){this.checkAndCleanCache()}},_=({src:e,alt:t,className:s="",style:r={},size:n=24,fallbackSrc:i="./vite.svg",showLoadingIndicator:c=!0,lazy:l=!1})=>{const[o,u]=a.useState(""),[d,m]=a.useState(!0),[h,p]=a.useState(!1),[y,f]=a.useState(!l),g=a.useRef(null),x=a.useRef(null);a.useEffect(()=>{if(!l)return;const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&!y&&(f(!0),e.disconnect())})},{rootMargin:"100px",threshold:.1});return g.current&&e.observe(g.current),()=>{e.disconnect()}},[l,y]),a.useEffect(()=>{if(!y)return;let t=!0;return(async()=>{try{m(!0),p(!1);const a=await N.loadIcon(e);t&&(u(a),m(!1),p(a===i))}catch(a){t&&(u(i),m(!1),p(!0))}})(),()=>{t=!1}},[e,i,y]);const S={width:n,height:n,objectFit:"contain",borderRadius:"4px",transition:"opacity 0.2s ease",opacity:d?.3:1,...r};return l&&!y?v.jsx("div",{ref:g,className:`async-icon-placeholder ${s}`,style:{width:n,height:n,backgroundColor:"#2a2a2a",borderRadius:"4px",...r}}):d&&c?v.jsx("div",{ref:l?g:void 0,className:`async-icon-loading ${s}`,style:{width:n,height:n,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#3a3a3a",borderRadius:"4px",...r},children:v.jsx("div",{className:"icon-loading-spinner"})}):v.jsx("div",{ref:l?g:void 0,children:v.jsx("img",{ref:x,src:o,alt:t,className:`async-icon ${s} ${h?"icon-error":""}`,style:S,onError:()=>{u(i),p(!0),m(!1)}})})},{Search:I}=n,w=({nodes:e,onNodeSelect:t})=>{const[s,r]=a.useState([]),[n,i]=a.useState(""),c=e=>e.map(e=>({key:e.id,title:v.jsxs("div",{className:"tree-node-content",children:[v.jsx("div",{className:"tree-node-icon",children:v.jsx(_,{src:e.icon,alt:e.name,size:20,showLoadingIndicator:!0,lazy:!0})}),v.jsx("div",{className:"tree-node-label",children:e.name}),"item"===e.type&&v.jsx("span",{className:"item-indicator",children:"‚ñ∂"})]}),children:e.children?c(e.children):void 0,node:e})),l=a.useMemo(()=>c(e),[e]),o=a.useMemo(()=>((e,t)=>{if(!t||t.length<2)return e;const a=t.toLowerCase(),s=e=>{if(e.node.name.toLowerCase().includes(a)||e.node.name_en.toLowerCase().includes(a))return e;if(e.children){const t=e.children.map(e=>s(e)).filter(Boolean);if(t.length>0)return{...e,children:t}}return null};return e.map(e=>s(e)).filter(Boolean)})(l,n),[l,n]),u=(e,t=0)=>e.map(e=>{const a=s.includes(e.key),r=e.children&&e.children.length>0;return v.jsxs("div",{className:"custom-tree-node",children:[v.jsxs("div",{className:`custom-tree-node-content ${e.node.type}`,onClick:()=>m(e),children:[v.jsxs("div",{className:"tree-switcher",children:[r&&v.jsx("span",{className:"switcher-icon "+(a?"expanded":""),children:"‚ñ∂"}),!r&&"item"===e.node.type&&v.jsx("span",{className:"item-indicator",children:"‚ñ∂"})]}),v.jsx("div",{className:"tree-node-icon",children:v.jsx(_,{src:e.node.icon,alt:e.node.name,size:20,showLoadingIndicator:!0,lazy:!0})}),v.jsx("div",{className:"tree-node-label",children:e.node.name})]}),r&&a&&v.jsx("div",{className:"tree-node-children",children:u(e.children,t+1)})]},e.key)}),d=e=>{const t=[];return e.children&&e.children.forEach(e=>{t.push(e.key),t.push(...d(e))}),t},m=e=>{if("group"===e.node.type&&e.children&&e.children.length>0){const t=new Set(s);if(t.has(e.key)){t.delete(e.key);d(e).forEach(e=>t.delete(e))}else t.add(e.key),(e=>{if(e.children&&e.children.length>0){const t=e.children.slice(0,10).map(e=>e.node.icon).filter(Boolean);t.length>0&&N.preloadIcons(t)}})(e);r(Array.from(t))}else null==t||t(e.node)};return v.jsxs("div",{className:"ant-tree-view",children:[v.jsxs("div",{className:"search-container",children:[v.jsx(I,{placeholder:"ÊêúÁ¥¢Áâ©ÂìÅÂêçÁß∞ÔºàËá≥Â∞ë2‰∏™Â≠óÁ¨¶Ôºâ...",allowClear:!0,value:n,onChange:e=>(e=>{i(e);const t=((e,t)=>{if(!t||t.length<2)return[];const a=[],s=e=>{e.forEach(e=>{a.push(e.key),e.children&&s(e.children)})};return s(e),a})(o,e);r(t)})(e.target.value),style:{marginBottom:8}}),n&&n.length<2&&v.jsx("div",{className:"search-hint",children:"ËØ∑ËæìÂÖ•Ëá≥Â∞ë2‰∏™Â≠óÁ¨¶ÂºÄÂßãÊêúÁ¥¢"})]}),v.jsx("div",{className:"custom-tree",children:u(o)})]})};const E=new class{constructor(){t(this,"eveData",null)}async loadEveData(){if(this.eveData)return this.eveData;try{const e=await fetch("./static/eve_blueprint_data.json"),t=await e.json();return this.eveData=t,t}catch(e){throw e}}getEveData(){return this.eveData}getBlueprintInfo(e){if(!this.eveData)return null;const{type_info:t,blueprint_materials:a,blueprint_outputs:s,reaction:r}=this.eveData;let n;const i=t[e.toString()];if(i&&i.bp_typeid)n=i.bp_typeid;else{if(!a[e.toString()]||!s[e.toString()])return null;n=e}const c=a[n.toString()];if(!c)return null;const l=s[n.toString()];if(!l)return null;const o=r.includes(n)?"reaction":"bp",u=c.materials.map(e=>{const a=t[e.typeID.toString()],s=(null==a?void 0:a.volume)||0;return{typeId:e.typeID,quantity:e.quantity,volume:s}});return{blueprintId:n,category:o,outputQuantity:l.quantity,materials:u}}buildTree(){if(!this.eveData)throw new Error("Êï∞ÊçÆÊú™Âä†ËΩΩ");const{market_tree:e,type_info:t,blueprint_outputs:a}=this.eveData,s=new Set(Object.values(a).map(e=>e.typeID)),r=new Map;Object.entries(t).forEach(([e,t])=>{null!=t.marketGroupID&&r.set(parseInt(e),t.marketGroupID)});const n=e=>{let t=!1;return r.forEach((a,r)=>{a===e.id&&s.has(r)&&(t=!0)}),!!t||e.children.some(e=>n(e))},i=e=>{if(!n(e))return null;const a={id:`group_${e.id}`,name:e.name,name_en:e.name_en,icon:`./static/icons/${e.icon_name}`,type:"group",children:[],isExpanded:!1},c=[];e.children.forEach(e=>{const t=i(e);t&&c.push(t)});const l=[];return r.forEach((a,r)=>{if(a===e.id&&s.has(r)){const e=t[r.toString()];e&&e.zh_name&&e.en_name&&e.icon_name&&l.push({id:`${r}`,name:e.zh_name,name_en:e.en_name,icon:`./static/icons/${e.icon_name}`,type:"item"})}}),a.children=[...c,...l],a},c=[];return e.forEach(e=>{const t=i(e);t&&c.push(t)}),c}},b=Object.freeze(Object.defineProperty({__proto__:null,dataService:E},Symbol.toStringTag,{value:"Module"})),k=e=>`${e.toLocaleString(void 0,{maximumFractionDigits:0})} ISK (${(e=>e>=1e9?`${(e/1e9).toFixed(1)}B`:e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toFixed(1))(e)})`;const C=new class{constructor(){t(this,"baseUrl","https://esi.evetech.net/latest")}async getStructureOrders(e,t){if(!e||!t)throw new Error("Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞ÔºöÂª∫Á≠ëIDÊàñËÆøÈóÆ‰ª§Áâå");try{const a=`${this.baseUrl}/markets/structures/${e}/?page=1`,s=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${t}`,"User-Agent":"EVE Blueprint Calculator"}});if(!s.ok)throw 401===s.status?new Error("ËÆ§ËØÅÂ§±Ë¥•ÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï"):403===s.status?new Error("Ê≤°ÊúâÊùÉÈôêËÆøÈóÆÊ≠§Âª∫Á≠ëÁöÑÂ∏ÇÂú∫Êï∞ÊçÆ"):404===s.status?new Error("Âª∫Á≠ë‰∏çÂ≠òÂú®ÊàñÊó†Â∏ÇÂú∫Êï∞ÊçÆ"):new Error(`Ëé∑ÂèñÂ∏ÇÂú∫Êï∞ÊçÆÂ§±Ë¥•: ${s.status} ${s.statusText}`);const r=parseInt(s.headers.get("X-Pages")||"1");let n=[...await s.json()];if(r>1){const a=Array.from({length:r-1},(e,t)=>t+2),s=10;for(let r=0;r<a.length;r+=s){const i=a.slice(r,r+s).map(a=>this.getPageData(e,a,t));(await Promise.allSettled(i)).forEach(e=>{"fulfilled"===e.status&&n.push(...e.value)}),r+s<a.length&&await new Promise(e=>setTimeout(e,100))}}return n}catch(a){if(a instanceof Error)throw a;throw new Error(`Ëé∑ÂèñÂª∫Á≠ëÂ∏ÇÂú∫ËÆ¢ÂçïÊó∂ÂèëÁîüÈîôËØØ: ${a}`)}}async getPageData(e,t,a){const s=`${this.baseUrl}/markets/structures/${e}/?page=${t}`,r=await fetch(s,{method:"GET",headers:{Authorization:`Bearer ${a}`,"User-Agent":"EVE Blueprint Calculator"}});if(!r.ok)throw new Error(`Ëé∑ÂèñÁ¨¨${t}È°µÊï∞ÊçÆÂ§±Ë¥•: ${r.status} ${r.statusText}`);return await r.json()}getItemPriceFromOrders(e,t){const a=e.filter(e=>e.type_id===t&&!e.is_buy_order&&e.volume_remain>0).map(e=>({price:e.price,volume_remain:e.volume_remain,order_id:e.order_id})).sort((e,t)=>e.price-t.price),s=a.length>0?a[0].price:null,r=a.reduce((e,t)=>e+t.volume_remain,0);return{type_id:t,sell_orders:a,lowest_sell_price:s,total_sell_volume:r}}getMultipleItemPrices(e,t){const a=new Map;return t.forEach(t=>{const s=this.getItemPriceFromOrders(e,t);a.set(t,s)}),a}async getItemPrice(e,t,a){const s=await this.getStructureOrders(e,a);return this.getItemPriceFromOrders(s,t)}async getMultipleItemPricesFromStructure(e,t,a){const s=await this.getStructureOrders(e,a);return this.getMultipleItemPrices(s,t)}};async function T(e,t,a){const s="string"==typeof a?{type:"region",id:a}:a;try{const a=await async function(e,t){try{if("structure"===t.type){if(!t.accessToken)throw new Error("Âª∫Á≠ëÂ∏ÇÂú∫ÈúÄË¶ÅËÆøÈóÆ‰ª§Áâå");const a=(await C.getStructureOrders(Number(t.id),t.accessToken)).filter(t=>t.type_id===e&&!t.is_buy_order&&t.volume_remain>0).map(e=>({duration:e.duration,is_buy_order:e.is_buy_order,issued:e.issued,location_id:e.location_id,min_volume:e.min_volume,order_id:e.order_id,price:e.price,range:e.range,system_id:0,type_id:e.type_id,volume_remain:e.volume_remain,volume_total:e.volume_total})).sort((e,t)=>e.price-t.price);return{typeID:e,orders:a}}return await D(e,String(t.id))}catch(a){return{typeID:e,orders:[]}}}(e,s),r=a.orders;if(0===r.length)return{totalPrice:0,ordersUsed:[],totalVolume:0};const n=r[0].price;return{totalPrice:n*t,ordersUsed:[{orderId:r[0].order_id,price:n,volumeUsed:t,volumeRemain:r[0].volume_remain}],totalVolume:t}}catch(r){s.type;throw r}}async function D(e,t){try{const a=await fetch(`https://esi.evetech.net/markets/${t}/orders?type_id=${e}&order_type=sell`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.json();return{typeID:e,orders:s.filter(e=>!e.is_buy_order).sort((e,t)=>e.price-t.price)}}catch(a){return{typeID:e,orders:[]}}}function $(e,t,a,s=!0){if(0===a.length)return{totalPrice:0,actualQuantity:0,isInsufficient:!0,lowestPrice:0};const r=a[0].price;if(!s){return{totalPrice:r*t,actualQuantity:t,isInsufficient:!1,lowestPrice:r}}let n=t,i=0;for(const l of a){if(n<=0)break;const e=Math.min(n,l.volume_remain);i+=e*l.price,n-=e}const c=t-n;return{totalPrice:i,actualQuantity:c,isInsufficient:c<t,lowestPrice:r}}function R(e,t,a=!0){let s=0;const r=[];for(const n of e){const e=t.get(n.typeID)||[],i=$(n.typeID,n.quantity,e,a);s+=i.totalPrice,r.push({typeID:n.typeID,quantity:n.quantity,price:i.totalPrice,isInsufficient:i.isInsufficient,actualQuantity:i.actualQuantity,lowestPrice:i.lowestPrice})}return{level:0,totalPrice:s,materialsCount:r.length,materials:r}}async function M(e,t,a=!0,s,r,n,i,c,l){try{const u="string"==typeof t?{type:"region",id:t}:t,d=function(e){const t=new Set;for(const a of e)for(const e of a)t.add(e.typeID);return Array.from(t)}(e),m=new Map;if("structure"===u.type)try{if(!u.accessToken)throw new Error("Âª∫Á≠ëÂ∏ÇÂú∫ÈúÄË¶ÅËÆøÈóÆ‰ª§Áâå");const e=await C.getStructureOrders(Number(u.id),u.accessToken);d.forEach(t=>{const a=e.filter(e=>e.type_id===t&&!e.is_buy_order&&e.volume_remain>0).map(e=>({duration:e.duration,is_buy_order:e.is_buy_order,issued:e.issued,location_id:e.location_id,min_volume:e.min_volume,order_id:e.order_id,price:e.price,range:e.range,system_id:0,type_id:e.type_id,volume_remain:e.volume_remain,volume_total:e.volume_total})).sort((e,t)=>e.price-t.price);m.set(t,a)})}catch(o){d.forEach(e=>{m.set(e,[])})}else{const e=d.map(async e=>{try{return{typeID:e,orders:(await D(e,String(u.id))).orders}}catch(o){return{typeID:e,orders:[]}}});(await Promise.all(e)).forEach(e=>{m.set(e.typeID,e.orders)})}const h=[];for(let t=0;t<e.length;t++){const u=R(e[t],m,a);if(u.level=t+1,void 0!==s&&void 0!==r&&void 0!==n)try{let a=[];a=c&&c[t]?c[t]:i&&i[t]?i[t]:e[t].map(e=>({typeID:e.typeID,quantity:e.quantity,typeName:`Material_${e.typeID}`}));const{marketPriceService:o}=await j(async()=>{const{marketPriceService:e}=await Promise.resolve().then(()=>z);return{marketPriceService:e}},void 0,import.meta.url),d=await o.calculateEIV(a),m=o.getTaxRateDetails(s,r,n,l||0),h=d*m.totalRate;u.eiv=d,u.facilityCost=h,u.totalTaxRate=m.totalRate}catch(o){}h.push(u)}for(let e=0;e<h.length;e++){const t=h[e];t.facilityCost;let a=0;for(let s=e;s>=0;s--)a+=h[s].facilityCost||0;t.cumulativeFacilityCost=a}return h}catch(o){throw o}}const B=new class{constructor(){t(this,"config",null)}async loadConfig(){if(this.config)return this.config;try{const e=await fetch("./config/structure-config.json"),t=await e.json();return this.config=t,t}catch(e){throw e}}getConfig(){return this.config}getComplexStructures(){if(!this.config)return[];const e=this.config.structure.complex.map(e=>({name:e.name,value:e.name}));return e.unshift({name:"Êó†Âª∫Á≠ë",value:"none"}),e}getRefineStructures(){if(!this.config)return[];const e=this.config.structure.refine.map(e=>({name:e.name,value:e.name}));return e.unshift({name:"Êó†Âª∫Á≠ë",value:"none"}),e}getComplexRigs(){return this.config?[{name:"Êó†Êèí‰ª∂",value:"none"},{name:"T1",value:"t1"},{name:"T2",value:"t2"}]:[]}getReactionRigs(){return this.config?[{name:"Êó†Êèí‰ª∂",value:"none"},{name:"T1",value:"t1"},{name:"T2",value:"t2"}]:[]}};const P=new class{constructor(){t(this,"data",null)}async loadData(){if(this.data)return this.data;try{const e=await fetch("./static/solar_systems.json"),t=await e.json();return this.data=t,t}catch(e){throw e}}getData(){return this.data}searchSolarSystems(e){if(!this.data||e.length<2)return[];const t=[],a=e.toLowerCase();for(const[,s]of Object.entries(this.data.solar_systems)){const e=s.solarSystemName_zh.toLowerCase().includes(a),r=s.solarSystemName_en.toLowerCase().includes(a);if(e||r){const e=s.solarSystemName_zh===s.solarSystemName_en?s.solarSystemName_zh:`${s.solarSystemName_zh}/${s.solarSystemName_en}`;t.push({id:s.solarSystemID,displayName:e,securityColor:this.getSecurityColor(s.display_security),displaySecurity:s.display_security})}}return t.filter((e,t,a)=>t===a.findIndex(t=>t.id===e.id)).sort((e,t)=>e.displayName.localeCompare(t.displayName))}getSolarSystemById(e){return this.data&&this.data.solar_systems[e.toString()]||null}getDisplayNameById(e){const t=this.getSolarSystemById(e);return t?t.solarSystemName_zh===t.solarSystemName_en?t.solarSystemName_zh:`${t.solarSystemName_zh}/${t.solarSystemName_en}`:null}getSecurityColor(e){switch(e){case 1:return"#4173d4";case.9:return"#5598e5";case.8:return"#73cbf4";case.7:return"#81d8a9";case.6:case.5:return"#8fe167";case.4:case.3:return"#d0712d";case.2:case.1:return"#bc1117";default:return e<=0?"#82375d":"#ff0000"}}getDisplayNameWithSecurity(e){const t=this.getSolarSystemById(e);if(!t)return null;return{displayName:t.solarSystemName_zh===t.solarSystemName_en?t.solarSystemName_zh:`${t.solarSystemName_zh}/${t.solarSystemName_en}`,securityColor:this.getSecurityColor(t.display_security),displaySecurity:t.display_security}}};const O=new class{constructor(){t(this,"systemsData",null),t(this,"lastFetchTime",0),t(this,"CACHE_DURATION",3e5)}async loadSystemsData(){const e=Date.now();if(this.systemsData&&e-this.lastFetchTime<this.CACHE_DURATION)return this.systemsData;try{const t=await fetch("https://esi.evetech.net/industry/systems");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return this.systemsData=a,this.lastFetchTime=e,a}catch(t){throw t}}getSystemsData(){return this.systemsData}getManufacturingCostIndex(e){if(!this.systemsData)return null;const t=this.systemsData.find(t=>t.solar_system_id===e);if(!t)return null;const a=t.cost_indices.find(e=>"manufacturing"===e.activity);return a?a.cost_index:null}getReactionCostIndex(e){if(!this.systemsData)return null;const t=this.systemsData.find(t=>t.solar_system_id===e);if(!t)return null;const a=t.cost_indices.find(e=>"reaction"===e.activity);return a?a.cost_index:null}formatCostIndex(e){return`${(100*e).toFixed(2)}%`}getSystemCostIndices(e){return{manufacturing:this.getManufacturingCostIndex(e),reaction:this.getReactionCostIndex(e)}}};const A=new class{constructor(){t(this,"priceCache",new Map),t(this,"lastFetchTime",0),t(this,"CACHE_DURATION",3e5)}async fetchMarketPrices(){try{const e=await fetch("https://esi.evetech.net/markets/prices");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){return[]}}async getAdjustedPrices(e){const t=Date.now();if(t-this.lastFetchTime<this.CACHE_DURATION&&this.priceCache.size>0){const t=new Map;for(const a of e){const e=this.priceCache.get(a);void 0!==e&&t.set(a,e)}return t}const a=await this.fetchMarketPrices();this.priceCache.clear();for(const r of a)this.priceCache.set(r.type_id,r.adjusted_price);this.lastFetchTime=t;const s=new Map;for(const r of e){const e=this.priceCache.get(r);void 0!==e&&s.set(r,e)}return s}async calculateEIV(e){const t=e.map(e=>e.typeID),a=await this.getAdjustedPrices(t);let s=0;for(const r of e){s+=(a.get(r.typeID)??0)*r.quantity}return s}getSystemCostIndex(e,t){let a;if(a=t?O.getReactionCostIndex(e):O.getManufacturingCostIndex(e),null!==a)return a;return.0014}getTaxRateDetails(e,t,a,s=0){const r=this.getSystemCostIndex(e,a),n=.04,i=t,c=s/100;return{costIndex:r,facilityTax:t,scc:n,structureTax:s,totalRate:r*i+(c+n),details:[`ÊòüÁ≥ªÊàêÊú¨ÊåáÊï∞ÔºàÁ≥ªÊï∞Ôºâ: ${(100*r).toFixed(2)}%`,`Âª∫Á≠ëË¥πÁî®ÂáèÂÖç: ${(100*i).toFixed(2)}%`,`ËÆæÊñΩÁ®éÁéá: ${(100*c).toFixed(2)}%`,`SCCË¥πÁî®: ${4..toFixed(2)}%`]}}async calculateFacilityCost(e){return await this.calculateEIV(e.materials)*this.getTaxRateDetails(e.solarSystemId,e.facilityTax,e.isReaction,e.structureTax||0).totalRate}},z=Object.freeze(Object.defineProperty({__proto__:null,marketPriceService:A},Symbol.toStringTag,{value:"Module"}));const L=new class{calculateBlueprintMaterials(e){const t=E.getEveData();if(!t)return[];const a=E.getBlueprintInfo(e.itemId);if(!a)return[];const s=this.calculateBonus(e);if(!s)return[];const r=[];return a.materials&&a.materials.forEach(a=>{var n;const i=a.quantity||0,c=i*e.runs;let l;l=i<=1?c:Math.ceil(c*s.materialBonus);const o=t.type_info[a.typeId.toString()],u=E.getBlueprintInfo(a.typeId),d={typeID:a.typeId,typeName_zh:(null==o?void 0:o.zh_name)||`Êú™Áü•Áâ©ÂìÅ_${a.typeId}`,typeName_en:(null==o?void 0:o.en_name)||`Unknown_${a.typeId}`,quantity:l,volume:null==o?void 0:o.volume,hasBlueprint:!!u,blueprintTypeID:(null==u?void 0:u.blueprintId)||null};if(r.push(d),e.isRecursive&&d.hasBlueprint&&d.blueprintTypeID&&!(null==(n=e.excludedMaterials)?void 0:n.has(a.typeId))&&(void 0===e.maxDepth||e.maxDepth>0)){e.globalMaterialEfficiency,e.globalTimeEfficiency,e.structureType,e.rigType,e.solarSystemId,e.excludedMaterials,void 0!==e.maxDepth&&e.maxDepth,e.globalMaterialEfficiency,e.globalTimeEfficiency;const t=E.getBlueprintInfo(d.blueprintTypeID);if(t){const e=l;Math.ceil(e/t.outputQuantity)}}}),r}calculateBonus(e){const t=E.getBlueprintInfo(e.itemId);if(!t)return null;const a="reaction"===t.category,s=a?1:1-.01*e.materialEfficiency,r=a?1:1-.01*e.timeEfficiency,n=B.getConfig();if(!n)return null;let i=1,c=1,l=1;if(a){if("none"!==e.structureType){const t=n.structure.refine.find(t=>t.name===e.structureType);t&&(i=t.ME,c=t.TE,l=t.Cost)}}else if("none"!==e.structureType){const t=n.structure.complex.find(t=>t.name===e.structureType);t&&(i=t.ME,c=t.TE,l=t.Cost)}let o=1,u=1;if("none"!==e.rigType){const t=a?n["reaction-rigs"][e.rigType]:n["complex-rigs"][e.rigType];if(t&&(u=t.Cost,e.solarSystemId)){const a=P.getSolarSystemById(e.solarSystemId);if(a){const e=a.display_security;let s=1;s=e>=.5?t.hs:e>=0?t.ls:t.ns,o=1-s*(1-t.ME)}}}return{materialBonus:s*i*o,timeBonus:r*c,costBonus:l*u,isReaction:a,blueprintME:s,blueprintTE:r,structureME:i,structureTE:c,structureCost:l,rigSecurityBonus:o,rigCost:u}}getOutputQuantity(e){const t=E.getBlueprintInfo(e);return(null==t?void 0:t.outputQuantity)||1}async calculateFacilityCost(e,t){if(!t.solarSystemId)return{facilityCost:0,eiv:0,costIndex:0,facilityTax:0,scc:.04,totalTaxRate:0,taxDetails:[]};const a=this.calculateBonus(t);if(!a)return{facilityCost:0,eiv:0,costIndex:0,facilityTax:0,scc:.04,totalTaxRate:0,taxDetails:[]};const s=E.getBlueprintInfo(t.itemId),r=[];(null==s?void 0:s.materials)&&s.materials.forEach(e=>{const a=(e.quantity||0)*t.runs,s=E.getEveData(),n=null==s?void 0:s.type_info[e.typeId.toString()];r.push({typeID:e.typeId,quantity:a,typeName:(null==n?void 0:n.zh_name)||`Êú™Áü•Áâ©ÂìÅ_${e.typeId}`})});const n={materials:r,solarSystemId:t.solarSystemId,facilityTax:a.structureCost,isReaction:a.isReaction,scc:.04},i=await A.calculateFacilityCost(n),c=A.getTaxRateDetails(t.solarSystemId,a.structureCost,a.isReaction);return{facilityCost:i,eiv:i/c.totalRate,costIndex:c.costIndex,facilityTax:c.facilityTax,scc:c.scc,totalTaxRate:c.totalRate,taxDetails:c.details}}},F=({selectedNode:e,settings:t,authToken:s})=>{var n;const[l,o]=a.useState({materialEfficiency:(null==t?void 0:t.materialEfficiency)??0,timeEfficiency:(null==t?void 0:t.timeEfficiency)??0,runs:(null==t?void 0:t.runs)??1}),[u,d]=a.useState((null==(n=null==t?void 0:t.runs)?void 0:n.toString())??"1"),[m,h]=a.useState((null==t?void 0:t.runs)??1),[p,y]=a.useState(new Set),[f,g]=a.useState(new Set),[x,S]=a.useState([]),[j,N]=a.useState(!1),[I,w]=a.useState(null),[b,C]=a.useState(!1);a.useEffect(()=>{var e;t&&(o({materialEfficiency:t.materialEfficiency,timeEfficiency:t.timeEfficiency,runs:t.runs}),d((null==(e=t.runs)?void 0:e.toString())??"1"),h(t.runs??1))},[t,null==e?void 0:e.id]),a.useEffect(()=>{y(new Set),g(new Set)},[null==e?void 0:e.id]),a.useEffect(()=>{const e=setTimeout(()=>{h(l.runs)},500);return()=>clearTimeout(e)},[l.runs]);const D=async a=>{if((null==t?void 0:t.marketSelection)||(null==t?void 0:t.structureMarketId)){N(!0);try{const r="structure"===t.marketType&&t.structureMarketId?{type:"structure",id:t.structureMarketId,accessToken:s||void 0}:{type:"region",id:t.marketSelection},n={itemId:parseInt((null==e?void 0:e.id)||"0"),runs:m,materialEfficiency:l.materialEfficiency,timeEfficiency:l.timeEfficiency,structureType:t.complexStructure,rigType:t.complexRig,solarSystemId:t.complexSolarSystem,excludedMaterials:f},i=L.calculateBonus(n),c=(null==B?void 0:B.materialLevels.map(e=>e.materials.filter(e=>e.hasBlueprint&&!f.has(e.typeID)).map(e=>({typeID:e.typeID,quantity:e.quantity,typeName:e.typeName_zh}))))||[],o=(null==B?void 0:B.materialLevels.map(e=>e.taxCalculationMaterials))||[],u=await M(a,r,t.considerOrderVolume,t.complexSolarSystem||void 0,null==i?void 0:i.structureCost,null==i?void 0:i.isReaction,c,o,t.complexTax||0);S(u)}catch(r){S([])}finally{N(!1)}}},$=async(e,t=!1)=>{try{const a=e.filter(e=>!f.has(e.typeID)).map(e=>`${t?e.typeName_en:e.typeName_zh} ${e.quantity.toLocaleString()}`).join("\n");await navigator.clipboard.writeText(a)}catch(a){}},R=(e,a,s,n=0)=>{const l=s?`${a}-${s}-${e.typeID}`:`${a}-${e.typeID}`,o=p.has(l),u=f.has(e.typeID),d=x.find(e=>e.level===a),m=null==d?void 0:d.materials.find(t=>t.typeID===e.typeID);return v.jsxs(r.Fragment,{children:[v.jsxs("div",{className:`material-item ${e.hasBlueprint?"has-blueprint":""} ${e.isReaction?"is-reaction":""} ${e.hasBlueprint?"clickable":""} ${u?"excluded":""}`,onClick:()=>((e,t,a)=>{if(!e.hasBlueprint)return;let s;s=a?`${t}-${a}-${e.typeID}`:`${t}-${e.typeID}`;const r=new Set(p);if(r.has(s)){r.delete(s);const a=[];r.forEach(s=>{s.startsWith(`${t}-${e.typeID}-`)&&a.push(s)}),a.forEach(e=>{r.delete(e)})}else r.add(s);y(r)})(e,a,s),style:{marginLeft:20*n+"px"},children:[v.jsx("div",{className:"material-icon",children:v.jsx(_,{src:`./static/icons/${e.typeIcon}`,alt:e.typeName_zh,size:24,showLoadingIndicator:!0})}),v.jsxs("div",{className:"material-info",children:[v.jsxs("div",{className:"material-name",children:[e.typeName_zh," √ó ",e.quantity.toLocaleString(),e.hasBlueprint&&v.jsx("span",{className:"expand-indicator "+(o?"expanded":""),children:o?"‚ñº":"‚ñ∂"})]}),m&&v.jsxs("div",{className:"material-price "+(m.isInsufficient?"insufficient":""),children:[k(m.price),m.isInsufficient&&v.jsxs("span",{className:"insufficient-warning",children:["(Â∫ìÂ≠ò‰∏çË∂≥: ",m.actualQuantity.toLocaleString(),"/",e.quantity.toLocaleString(),")"]})]}),j&&!m&&v.jsx("div",{className:"material-price-loading",children:"ËÆ°ÁÆó‰ª∑Ê†º‰∏≠..."})]}),v.jsxs("div",{className:"material-volume",children:[(e.totalVolume||0).toFixed(2)," m¬≥"]}),v.jsx("div",{className:"material-blueprint-status",children:e.hasBlueprint?e.isReaction?v.jsx("span",{className:"reaction-badge",children:"ÂèçÂ∫î"}):v.jsx("span",{className:"blueprint-badge",children:"ËìùÂõæ"}):v.jsx("span",{className:"no-blueprint-badge",children:"Êó†ËìùÂõæ"})}),e.hasBlueprint&&v.jsx("div",{className:"material-exclusion-control",children:v.jsx("button",{className:"exclusion-button "+(u?"excluded":""),onClick:t=>{t.stopPropagation(),(e=>{const t=new Set(f);t.has(e)?t.delete(e):t.add(e),g(t)})(e.typeID)},title:u?"ÊÅ¢Â§çÊãÜËß£":"ÊéíÈô§ÊãÜËß£",children:u?v.jsx(i,{}):v.jsx(c,{})})})]}),o&&e.hasBlueprint&&e.blueprintTypeID&&t&&(()=>{const s=E.getBlueprintInfo(e.typeID);if(!s||!e.blueprintTypeID)return null;const r=u?v.jsx("div",{className:"excluded-material-notice",style:{marginLeft:20*(n+1)+"px"},children:v.jsxs("div",{className:"notice-content",children:[v.jsx("span",{className:"notice-icon",children:"‚ÑπÔ∏è"}),v.jsx("span",{className:"notice-text",children:"Ê≠§ÊùêÊñôÂ∑≤Ë¢´ÊéíÈô§ÔºåÂÖ∂Â≠êÊùêÊñô‰∏ç‰ºöÂú®ÂêéÁª≠Â±ÇÁ∫ß‰∏≠ÁªßÁª≠ÊãÜËß£"})]})}):null,i=e.quantity||0,c=Math.ceil(i/s.outputQuantity),l="reaction"===s.category,o={itemId:e.blueprintTypeID,runs:c,materialEfficiency:(null==t?void 0:t.materialEfficiency)||0,timeEfficiency:(null==t?void 0:t.timeEfficiency)||0,structureType:l?t.refineStructure:t.complexStructure,rigType:l?t.reactionRig:t.complexRig,solarSystemId:l?t.refineSolarSystem:t.complexSolarSystem,excludedMaterials:f,isRecursive:!1,maxDepth:1,globalMaterialEfficiency:(null==t?void 0:t.materialEfficiency)||0,globalTimeEfficiency:(null==t?void 0:t.timeEfficiency)||0},d=L.calculateBlueprintMaterials(o).map(t=>{const s=E.getEveData(),r=null==s?void 0:s.type_info[t.typeID.toString()],i=(t.volume||(null==r?void 0:r.volume)||0)*t.quantity,c=t.hasBlueprint,l=c&&t.blueprintTypeID&&(null==s?void 0:s.reaction.includes(t.blueprintTypeID))||!1;return R({typeID:t.typeID,typeName_zh:t.typeName_zh,typeName_en:t.typeName_en,typeIcon:(null==r?void 0:r.icon_name)||"",quantity:t.quantity,totalVolume:i,hasBlueprint:c||!1,isReaction:l||!1,blueprintTypeID:t.blueprintTypeID},a,e.typeID,n+1)});return v.jsxs(v.Fragment,{children:[r,d]})})()]},l)},B=a.useMemo(()=>{if(!e||"item"!==e.type||!t)return null;const a=parseInt(e.id),s=(()=>{const e=E.getBlueprintInfo(a);return"reaction"===(null==e?void 0:e.category)})(),r={itemId:a,runs:m||1,materialEfficiency:l.materialEfficiency,timeEfficiency:l.timeEfficiency,structureType:s?t.refineStructure:t.complexStructure,rigType:s?t.reactionRig:t.complexRig,solarSystemId:s?t.refineSolarSystem:t.complexSolarSystem,excludedMaterials:f,isRecursive:!1,maxDepth:1,globalMaterialEfficiency:(null==t?void 0:t.materialEfficiency)||0,globalTimeEfficiency:(null==t?void 0:t.timeEfficiency)||0},n=L.calculateBlueprintMaterials(r),i=n.map(e=>{const t=E.getEveData(),a=null==t?void 0:t.type_info[e.typeID.toString()],s=e.volume||(null==a?void 0:a.volume)||0;return{typeID:e.typeID,typeName_zh:e.typeName_zh,typeName_en:e.typeName_en,typeIcon:(null==a?void 0:a.icon_name)||"",quantity:e.quantity,volume:s,totalVolume:s*e.quantity,hasBlueprint:e.hasBlueprint||!1,isReaction:(()=>{if(!e.hasBlueprint||!e.blueprintTypeID)return!1;const t=E.getEveData();return(null==t?void 0:t.reaction.includes(e.blueprintTypeID))||!1})()||!1,blueprintTypeID:e.blueprintTypeID}}).sort((e,t)=>{const a=f.has(e.typeID),s=f.has(t.typeID);return a&&!s?-1:!a&&s?1:e.typeID-t.typeID}),c=(()=>{const e=[],s=E.getBlueprintInfo(a),r=[];(null==s?void 0:s.materials)&&s.materials.forEach(e=>{if(!f.has(e.typeId)){const t=(e.quantity||0)*m,a=E.getEveData(),s=null==a?void 0:a.type_info[e.typeId.toString()];r.push({typeID:e.typeId,quantity:t,typeName:(null==s?void 0:s.zh_name)||`Êú™Áü•Áâ©ÂìÅ_${e.typeId}`})}}),e.push({level:1,materials:i,hasNextLevel:i.some(e=>e.hasBlueprint&&!f.has(e.typeID)),taxCalculationMaterials:r});let n=1,c=i,o=c.some(e=>e.hasBlueprint&&!f.has(e.typeID));for(;o;){const a=new Map;c.forEach(e=>{if(e.hasBlueprint&&e.blueprintTypeID&&!f.has(e.typeID)){const s=E.getBlueprintInfo(e.typeID);if(s&&e.blueprintTypeID){const r=e.quantity||0,n=Math.ceil(r/s.outputQuantity),i="reaction"===s.category,c={itemId:e.blueprintTypeID,runs:n,materialEfficiency:(null==t?void 0:t.materialEfficiency)||0,timeEfficiency:(null==t?void 0:t.timeEfficiency)||0,structureType:i?t.refineStructure:t.complexStructure,rigType:i?t.reactionRig:t.complexRig,solarSystemId:i?t.refineSolarSystem:t.complexSolarSystem,excludedMaterials:f,isRecursive:!1,maxDepth:1,globalMaterialEfficiency:(null==t?void 0:t.materialEfficiency)||0,globalTimeEfficiency:(null==t?void 0:t.timeEfficiency)||0};L.calculateBlueprintMaterials(c).forEach(e=>{const t=E.getEveData(),s=null==t?void 0:t.type_info[e.typeID.toString()],r=e.volume||(null==s?void 0:s.volume)||0,n=r*e.quantity,i=e.hasBlueprint,c=i&&e.blueprintTypeID&&(null==t?void 0:t.reaction.includes(e.blueprintTypeID))||!1,l=a.get(e.typeID);l?(l.quantity+=e.quantity,l.totalVolume=(l.totalVolume||0)+n):a.set(e.typeID,{typeID:e.typeID,typeName_zh:e.typeName_zh,typeName_en:e.typeName_en,typeIcon:(null==s?void 0:s.icon_name)||"",quantity:e.quantity,volume:r,totalVolume:n,hasBlueprint:i||!1,isReaction:c||!1,blueprintTypeID:e.blueprintTypeID})})}}else{const t=a.get(e.typeID);t?(t.quantity+=e.quantity,t.totalVolume=(t.totalVolume||0)+(e.totalVolume||0)):a.set(e.typeID,{typeID:e.typeID,typeName_zh:e.typeName_zh,typeName_en:e.typeName_en,typeIcon:e.typeIcon,quantity:e.quantity,volume:e.volume,totalVolume:e.totalVolume,hasBlueprint:e.hasBlueprint,isReaction:e.isReaction,blueprintTypeID:e.blueprintTypeID})}});const s=Array.from(a.values()).sort((e,t)=>{const a=f.has(e.typeID),s=f.has(t.typeID);return a&&!s?-1:!a&&s?1:e.typeID-t.typeID}),r=[];c.forEach(e=>{if(e.hasBlueprint&&e.blueprintTypeID&&!f.has(e.typeID)){const a=E.getBlueprintInfo(e.typeID);if(a&&e.blueprintTypeID){const s=e.quantity||0,n=Math.ceil(s/a.outputQuantity),i={itemId:e.blueprintTypeID,runs:1,materialEfficiency:l.materialEfficiency,timeEfficiency:l.timeEfficiency,structureType:(null==t?void 0:t.complexStructure)||"engineering_complex",rigType:(null==t?void 0:t.complexRig)||"none",solarSystemId:(null==t?void 0:t.complexSolarSystem)||null,excludedMaterials:f};if(!L.calculateBonus(i))return;a.materials.forEach(e=>{const t=(e.quantity||0)*n,a=r.findIndex(t=>t.typeID===e.typeId);if(a>=0)r[a].quantity+=t;else{const a=E.getEveData(),s=null==a?void 0:a.type_info[e.typeId.toString()];r.push({typeID:e.typeId,quantity:t,typeName:(null==s?void 0:s.zh_name)||`Êú™Áü•Áâ©ÂìÅ_${e.typeId}`})}})}}}),n++,c=s,o=c.some(e=>e.hasBlueprint&&!f.has(e.typeID)),e.push({level:n,materials:s,hasNextLevel:o,taxCalculationMaterials:r})}return e})(),o=L.getOutputQuantity(a);return{blueprintName_zh:e.name,blueprintName_en:e.name_en,outputQuantity:o,materials:i,materialLevels:c,blueprintMaterials:n}},[null==e?void 0:e.id,null==e?void 0:e.type,m,l.materialEfficiency,l.timeEfficiency,f,null==t?void 0:t.marketSelection]);return a.useEffect(()=>{if(!B||!(null==t?void 0:t.marketSelection))return;const a=B.materialLevels.map(e=>e.materials.map(e=>({typeID:e.typeID,quantity:e.quantity})));if(a.length>0&&D(a),B.outputQuantity){const a=B.outputQuantity*m;(async(e,a)=>{if((null==t?void 0:t.marketSelection)||(null==t?void 0:t.structureMarketId)){C(!0);try{const r="structure"===t.marketType&&t.structureMarketId?{type:"structure",id:t.structureMarketId,accessToken:s||void 0}:{type:"region",id:t.marketSelection},n=await T(e,a,r);w({price:n.totalPrice,isInsufficient:!1,actualQuantity:a})}catch(r){w(null)}finally{C(!1)}}})(parseInt((null==e?void 0:e.id)||"0"),a)}},[B,null==t?void 0:t.marketSelection,null==t?void 0:t.considerOrderVolume,null==t?void 0:t.complexSolarSystem,m,null==e?void 0:e.id,f]),e?"item"!==e.type?v.jsx("div",{className:"blueprint-view",children:v.jsxs("div",{className:"no-blueprint",children:[v.jsx("div",{className:"no-blueprint-icon",children:"üìÅ"}),v.jsx("div",{className:"no-blueprint-text",children:"Ê≠§ÂàÜÁ±ª‰∏çÂåÖÂê´Âà∂ÈÄ†‰ø°ÊÅØ"})]})}):B?v.jsxs("div",{className:"blueprint-view",children:[v.jsx("div",{className:"blueprint-header",children:v.jsxs("div",{className:"blueprint-header-content",children:[v.jsx("div",{className:"blueprint-icon",children:v.jsx(_,{src:(()=>{const t=E.getEveData(),a=null==t?void 0:t.type_info[e.id];return(null==a?void 0:a.icon_name)?`./static/icons/${a.icon_name}`:`./static/icons/icon_${e.id}_64.png`})(),alt:B.blueprintName_zh,size:64,showLoadingIndicator:!0})}),v.jsxs("div",{className:"blueprint-info",children:[v.jsxs("div",{className:"blueprint-name",children:[B.blueprintName_zh,v.jsxs("span",{className:"blueprint-name-en",children:[" (",B.blueprintName_en,")"]})]}),(()=>{const t=e&&"item"===e.type?E.getBlueprintInfo(parseInt(e.id)):null,a="reaction"===(null==t?void 0:t.category);return v.jsxs("div",{className:"blueprint-settings",children:[v.jsxs("div",{className:"blueprint-setting-item",children:[v.jsx("label",{children:"ÊµÅÁ®ãÊï∞:"}),v.jsx("input",{type:"number",min:"1",max:"10000",value:u,onFocus:e=>{e.target.select()},onChange:e=>{const t=e.target.value;d(t);const a=""===t||isNaN(parseInt(t))?1:Math.max(1,parseInt(t));o({...l,runs:a})},onBlur:e=>{""===e.target.value&&(d("1"),o({...l,runs:1}))}})]}),v.jsxs("div",{className:"blueprint-setting-item",children:[v.jsx("label",{children:"ÊùêÊñôÊïàÁéá:"}),v.jsx("select",{value:l.materialEfficiency,disabled:a,onChange:e=>o({...l,materialEfficiency:parseInt(e.target.value)}),children:Array.from({length:11},(e,t)=>t).map(e=>v.jsx("option",{value:e,children:e},e))})]}),v.jsxs("div",{className:"blueprint-setting-item",children:[v.jsx("label",{children:"Êó∂Èó¥ÊïàÁéá:"}),v.jsx("select",{value:l.timeEfficiency,disabled:a,onChange:e=>o({...l,timeEfficiency:parseInt(e.target.value)}),children:Array.from({length:11},(e,t)=>2*t).map(e=>v.jsx("option",{value:e,children:e},e))})]}),v.jsx("div",{className:"blueprint-setting-item",children:v.jsx("span",{className:"disabled-hint",children:"Ê≠§Â§ÑÈÄâÈ°π‰ºöË¶ÜÁõñËÆæÁΩÆ‰∏≠ÁöÑÈªòËÆ§ÊïàÁéáÔºå‰ªÖÂΩ±ÂìçÊ≠§ËìùÂõæ"})})]})})(),v.jsx("div",{className:"output-info",children:(()=>{const a=(()=>{if(!t)return null;const a={...t,...l},s=e&&"item"===e.type?parseInt(e.id):null;if(!s)return null;const r=E.getBlueprintInfo(s);if(!r)return null;const n="reaction"===r.category,i={itemId:s,runs:1,materialEfficiency:a.materialEfficiency,timeEfficiency:a.timeEfficiency,structureType:n?a.refineStructure:a.complexStructure,rigType:n?a.reactionRig:a.complexRig,solarSystemId:n?a.refineSolarSystem:a.complexSolarSystem},c=L.calculateBonus(i);if(!c)return null;const o=e=>{const t=Math.round(1e5*e)/1e5;return t%1==0?t.toString():t.toFixed(5).replace(/\.?0+$/,"")},u=`${o(100*(1-c.materialBonus))}%`,d=`${o(100*(1-c.timeBonus))}%`,m=`${o(100*(1-c.costBonus))}%`;return{materialBonus:c.materialBonus,timeBonus:c.timeBonus,costBonus:c.costBonus,materialBonusText:u,timeBonusText:d,costBonusText:m,materialComponents:{blueprintME:c.blueprintME,structureME:c.structureME,rigSecurityBonus:c.rigSecurityBonus},timeComponents:{blueprintTE:c.blueprintTE,structureTE:c.structureTE},costComponents:{structureCost:c.structureCost,rigCost:c.rigCost}}})(),s=B.outputQuantity*m;return v.jsxs("div",{className:"bonus-info-container",children:[v.jsxs("div",{className:"output-row",children:[v.jsxs("div",{className:"bonus-item",children:["‰∫ßÂá∫Êï∞Èáè: ",(e=>{const t=Math.round(1e5*e)/1e5;return t%1==0?t.toString():t.toFixed(5).replace(/\.?0+$/,"")})(s)]}),a&&v.jsxs(v.Fragment,{children:[v.jsxs("div",{className:"bonus-item",children:["ÊùêÊñôÂä†Êàê: -",a.materialBonusText]}),v.jsxs("div",{className:"bonus-item",children:["Êó∂Èó¥Âä†Êàê: -",a.timeBonusText]}),v.jsxs("div",{className:"bonus-item",children:["ÊàêÊú¨Âä†Êàê: -",a.costBonusText]})]})]}),I&&v.jsxs("div",{className:"bonus-item product-price "+(I.isInsufficient?"insufficient":""),children:["‰∫ßÂìÅÂîÆ‰ª∑: ",k(I.price),I.isInsufficient&&v.jsxs("span",{className:"insufficient-warning",children:["(Â∫ìÂ≠ò‰∏çË∂≥: ",I.actualQuantity.toLocaleString(),"/",s.toLocaleString(),")"]})]}),b&&!I&&v.jsx("div",{className:"bonus-item product-price-loading",children:"ËÆ°ÁÆó‰∫ßÂìÅÂîÆ‰ª∑‰∏≠..."})]})})()})]})]})}),v.jsxs("div",{className:"materials-section",children:[v.jsx("h4",{children:"ÊùêÊñôÈúÄÊ±Ç"}),v.jsx("div",{className:"materials-columns",children:B.materialLevels.map(e=>{const t=x.find(t=>t.level===e.level);return v.jsxs("div",{className:"materials-column",children:[v.jsxs("div",{className:"materials-column-header",children:[v.jsxs("div",{className:"header-title-section",children:[v.jsxs("h5",{className:(null==t?void 0:t.materials.some(e=>e.isInsufficient))?"layer-title insufficient":"layer-title",children:["Á¨¨",e.level,"Â±ÇÊùêÊñô",(()=>{const t=e.materials.reduce((e,t)=>e+(t.totalVolume||0),0);return` (${a=t,a>=1e6?`${(a/1e6).toFixed(2)}M`:a>=1e3?`${(a/1e3).toFixed(2)}K`:a.toFixed(2)} m¬≥)`;var a})()]}),v.jsxs("div",{className:"copy-buttons",children:[v.jsx("button",{className:"copy-button",onClick:()=>$(e.materials,!1),title:"Â§çÂà∂(‰∏≠Êñá)",children:"Â§çÂà∂(‰∏≠Êñá)"}),v.jsx("button",{className:"copy-button",onClick:()=>$(e.materials,!0),title:"Â§çÂà∂(Ëã±Êñá)",children:"Â§çÂà∂(Ëã±Êñá)"})]})]}),v.jsxs("div",{className:"copy-buttons",children:[t&&v.jsxs("div",{className:"level-total-price",children:["ÊùêÊñôÊÄª‰ª∑: ",k(t.totalPrice),t.facilityCost&&v.jsxs("div",{className:"level-facility-cost",children:["Âä†Â∑•Á®éË¥π: ",k(t.facilityCost),v.jsxs("span",{className:"facility-cost-rate",children:["(Á®éÁéá: ",(100*t.totalTaxRate).toFixed(2),"%)"]})]}),t.cumulativeFacilityCost&&t.cumulativeFacilityCost>0&&v.jsxs("div",{className:"level-cumulative-cost",children:["ÊÄªËÆ°Á®éË¥π: ",k(t.cumulativeFacilityCost),v.jsx("span",{className:"cumulative-cost-hint",children:"(Âä†Â∑•Âà∞‰∫ßÂìÅÁöÑÊÄªÁ®éË¥π)"})]}),t.cumulativeFacilityCost&&t.cumulativeFacilityCost>0&&v.jsxs("div",{className:"level-total-cost-with-tax",children:["ÊÄªÊàêÊú¨: ",k(t.totalPrice+t.cumulativeFacilityCost),v.jsx("span",{className:"total-cost-hint",children:"(ÊùêÊñôÊÄª‰ª∑+ÊÄªËÆ°Á®éË¥π)"})]})]}),j&&!t&&v.jsx("div",{className:"level-price-loading",children:"ËÆ°ÁÆó‰ª∑Ê†º‰∏≠..."})]})]}),v.jsx("div",{className:"materials-list",children:e.materials.map(t=>R(t,e.level))})]},e.level)})})]})]}):v.jsx("div",{className:"blueprint-view",children:v.jsxs("div",{className:"no-blueprint",children:[v.jsx("div",{className:"no-blueprint-icon",children:"‚ö†Ô∏è"}),v.jsx("div",{className:"no-blueprint-text",children:"Ê≠§Áâ©ÂìÅÊ≤°ÊúâÂà∂ÈÄ†ËìùÂõæ"})]})}):v.jsx("div",{className:"blueprint-view",children:v.jsxs("div",{className:"no-selection",children:[v.jsx("div",{className:"no-selection-icon",children:"üìã"}),v.jsx("div",{className:"no-selection-text",children:"ËØ∑‰ªéÂ∑¶‰æßÈÄâÊã©‰∏Ä‰∏™Áâ©ÂìÅ"})]})})},V={clientId:"d43fa6a824234f0ab8e8a56f6d039c6c",clientSecret:"SAJGfQzounfKKfmc181GLOaKxBVQcUChRPeqcrEf",redirectUri:(()=>{const e=window.location.origin;return e.includes("localhost")||e.includes("127.0.0.1")?"http://localhost:5173/auth/callback":"https://estamelgg.github.io/EVE_BP_Calc/auth/callback"})(),authorizationEndpoint:"https://login.eveonline.com/v2/oauth/authorize/",tokenEndpoint:"https://login.eveonline.com/v2/oauth/token",jwksUri:"https://login.eveonline.com/oauth/jwks",oauthMetadataEndpoint:"https://login.eveonline.com/.well-known/oauth-authorization-server",baseURL:"https://login.eveonline.com",scopes:["esi-search.search_structures.v1","esi-markets.structure_markets.v1","esi-universe.read_structures.v1"]};async function U(){const e=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),{codeVerifier:t,codeChallenge:a}=await async function(){const e=new Uint8Array(32);crypto.getRandomValues(e);const t=btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),a=(new TextEncoder).encode(t),s=await crypto.subtle.digest("SHA-256",a);return{codeVerifier:t,codeChallenge:btoa(String.fromCharCode(...new Uint8Array(s))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}}(),s=new URLSearchParams({response_type:"code",redirect_uri:V.redirectUri,client_id:V.clientId,scope:V.scopes.join(" "),state:e,code_challenge:a,code_challenge_method:"S256"}),r=`${V.authorizationEndpoint}?${s.toString()}`;return localStorage.setItem("eve_oauth_state",e),localStorage.setItem("eve_oauth_code_verifier",t),{authUrl:r,state:e,codeVerifier:t}}function q(e,t=2){try{const a=J(e);if(!a.exp)return!0;const s=1e3*a.exp,r=Date.now();return r+60*t*1e3>=s}catch(a){return!0}}function Q(e){try{const t=J(e);if(!t.exp)return 0;const a=1e3*t.exp,s=Date.now(),r=Math.max(0,a-s);return Math.floor(r/6e4)}catch(t){return 0}}function J(e){try{const t=e.split(".");if(3!==t.length)throw new Error("Invalid JWT format");return JSON.parse(atob(t[1]))}catch(t){throw new Error("Failed to parse JWT payload")}}async function K(e){if(!e)throw new Error("Âà∑Êñ∞‰ª§Áâå‰∏∫Á©∫");try{const a=await fetch(V.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${btoa(`${V.clientId}:${V.clientSecret}`)}`},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:e})});if(!a.ok){let e="";try{e=await a.text()}catch(t){e="Êó†Ê≥ïËé∑ÂèñÈîôËØØËØ¶ÊÉÖ"}throw new Error(`Âà∑Êñ∞tokenÂ§±Ë¥•: ${a.status} ${a.statusText}. ${e}`)}return await a.json()}catch(a){throw a}}async function W(e,t,a){if(!e||!t)throw new Error("ËÆøÈóÆ‰ª§ÁâåÊàñÂà∑Êñ∞‰ª§Áâå‰∏∫Á©∫");if(!q(e,2))return{accessToken:e,refreshToken:t,needsRefresh:!1};try{const e=await K(t);return a&&a(e),{accessToken:e.access_token,refreshToken:e.refresh_token||t,needsRefresh:!0}}catch(s){throw s}}const H=Object.freeze(Object.defineProperty({__proto__:null,autoRefreshToken:W,getCharacterInfo:async function(e){try{const t=await async function(e){try{const t=await async function(){const e=await fetch(V.jwksUri);if(!e.ok)throw new Error("Failed to fetch JWKS");const t=await e.json();return t}(),a=e.split(".");if(3!==a.length)throw new Error("Invalid JWT format");const s=JSON.parse(atob(a[0]));if(!t.keys.find(e=>e.kid===s.kid))throw new Error("No matching key found in JWKS");return JSON.parse(atob(a[1]))}catch(t){throw t}}(e);return{CharacterName:t.name||t.sub,CharacterID:t.sub.replace("CHARACTER:EVE:",""),ExpiresOn:new Date(1e3*t.exp).toISOString(),Scopes:t.scp||t.scope||[],Issuer:t.iss,IssuedAt:new Date(1e3*t.iat).toISOString()}}catch(t){throw t}},getTokenRemainingTime:Q,handleOAuthCallback:async function(e,t){const a=localStorage.getItem("eve_oauth_state"),s=localStorage.getItem("eve_oauth_code_verifier");if(t!==a)throw new Error("OAuth state mismatch");if(!s)throw new Error("Code verifier not found");const r=await fetch(V.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${btoa(`${V.clientId}:${V.clientSecret}`)}`},body:new URLSearchParams({grant_type:"authorization_code",code:e,code_verifier:s,redirect_uri:V.redirectUri})});if(!r.ok){let e="";try{e=await r.text()}catch(i){e="Êó†Ê≥ïËé∑ÂèñÈîôËØØËØ¶ÊÉÖ"}throw new Error(`Failed to exchange code for token: ${r.status} ${r.statusText}. ${e}`)}const n=await r.json();return localStorage.removeItem("eve_oauth_state"),localStorage.removeItem("eve_oauth_code_verifier"),n},initializeEveOAuth:async function(){try{const e=await async function(){const e=await fetch(V.oauthMetadataEndpoint);if(!e.ok)throw new Error("Failed to fetch OAuth metadata");return await e.json()}();e.authorization_endpoint,V.authorizationEndpoint,e.token_endpoint,V.tokenEndpoint,e.jwks_uri,V.jwksUri}catch(e){throw e}},isTokenExpiringSoon:q,refreshToken:K,startEveOAuth:U},Symbol.toStringTag,{value:"Module"})),G=({isOpen:e,onClose:t,onAuthSuccess:s,currentToken:r,currentCharacter:n})=>{const[i,c]=a.useState(!1),[l,o]=a.useState(null);a.useEffect(()=>{},[e]);return e?v.jsx("div",{className:"auth-overlay",children:v.jsxs("div",{className:"auth-modal",children:[v.jsxs("div",{className:"auth-header",children:[v.jsx("h2",{children:"EVE Online ËÆ§ËØÅ"}),v.jsx("button",{className:"auth-close",onClick:t,children:"‚úï"})]}),v.jsxs("div",{className:"auth-content",children:[l&&v.jsxs("div",{className:"auth-error",children:[v.jsx("div",{className:"error-icon",children:"‚ö†Ô∏è"}),v.jsx("div",{className:"error-text",children:l})]}),r&&n?v.jsxs("div",{className:"auth-success",children:[v.jsxs("div",{className:"character-info",children:[v.jsx("div",{className:"character-avatar",children:v.jsx("img",{src:`https://images.evetech.net/characters/${n.CharacterID}/portrait?size=64`,alt:"ËßíËâ≤Â§¥ÂÉè"})}),v.jsxs("div",{className:"character-details",children:[v.jsx("h3",{children:n.CharacterName}),v.jsx("p",{className:"character-status",children:"Â∑≤ËÆ§ËØÅ"}),v.jsxs("p",{className:"character-id",children:["ËßíËâ≤ID: ",n.CharacterID]})]})]}),v.jsx("div",{className:"auth-actions",children:v.jsx("button",{className:"auth-button-logout",onClick:()=>{s("","",null),t()},children:"ÈÄÄÂá∫ÁôªÂΩï"})})]}):v.jsxs("div",{className:"auth-login",children:[v.jsxs("div",{className:"auth-description",children:[v.jsx("p",{children:"ÈÄöËøáEVE Online SSOËøõË°åËÆ§ËØÅÔºåËé∑Âèñ‰ª•‰∏ãÊùÉÈôêÔºö"}),v.jsxs("ul",{children:[v.jsx("li",{children:"ÊêúÁ¥¢Âª∫Á≠ë‰ø°ÊÅØ"}),v.jsx("li",{children:"ËÆøÈóÆÂª∫Á≠ëÂ∏ÇÂú∫Êï∞ÊçÆ"})]})]}),v.jsx("div",{className:"auth-actions",children:i?v.jsxs("div",{className:"auth-loading",children:[v.jsx("div",{className:"loading-spinner"}),v.jsx("span",{children:"Ê≠£Âú®Â§ÑÁêÜ..."})]}):v.jsx("button",{className:"auth-button-login",onClick:async()=>{c(!0),o(null);try{const{authUrl:e}=await U();window.location.href=e}catch(e){o(e instanceof Error?e.message:"ÂêØÂä®ËÆ§ËØÅÂ§±Ë¥•"),c(!1)}},children:v.jsx("img",{src:"./eve_auth.png",alt:"EVE"})})})]})]})]})}):null};const X=new class{constructor(){t(this,"cacheKey","eve_structure_info_cache"),t(this,"cacheExpiryMinutes",30)}getCachedStructureInfo(e){try{const t=this.loadCache(),a=t[e.toString()];return a?Date.now()>a.expiresAt?(delete t[e.toString()],this.saveCache(t),null):a:null}catch(t){return null}}getCachedStructureName(e){const t=this.getCachedStructureInfo(e);return t?t.name:null}cacheStructureInfo(e,t,a){try{const s=this.loadCache(),r=Date.now(),n=r+60*this.cacheExpiryMinutes*1e3;s[e.toString()]={structure_id:e,name:t,type_id:a,timestamp:r,expiresAt:n},this.saveCache(s)}catch(s){}}cacheStructureName(e,t){this.cacheStructureInfo(e,t,0)}cacheStructureInfos(e){try{const t=this.loadCache(),a=Date.now(),s=a+60*this.cacheExpiryMinutes*1e3;e.forEach(e=>{t[e.structure_id.toString()]={structure_id:e.structure_id,name:e.name,type_id:e.type_id,timestamp:a,expiresAt:s}}),this.saveCache(t)}catch(t){}}cacheStructureNames(e){const t=e.map(e=>({structure_id:e.structure_id,name:e.name,type_id:0}));this.cacheStructureInfos(t)}cleanExpiredCache(){try{const e=this.loadCache(),t=Date.now();let a=0;Object.keys(e).forEach(s=>{e[s].expiresAt<=t&&(delete e[s],a++)}),a>0&&this.saveCache(e)}catch(e){}}getCacheStats(){try{const e=this.loadCache(),t=Date.now();let a=0,s=0,r=0;return Object.values(e).forEach(e=>{a++,e.expiresAt<=t?s++:r++}),{total:a,expired:s,valid:r}}catch(e){return{total:0,expired:0,valid:0}}}clearAllCache(){try{localStorage.removeItem(this.cacheKey)}catch(e){}}loadCache(){try{const e=localStorage.getItem(this.cacheKey);return e?JSON.parse(e):{}}catch(e){return{}}}saveCache(e){try{localStorage.setItem(this.cacheKey,JSON.stringify(e))}catch(t){}}};const Y=new class{constructor(){t(this,"baseUrl","https://esi.evetech.net/latest")}async searchStructures(e,t,a){if(!e||!t||!a)throw new Error("Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞ÔºöËßíËâ≤ID„ÄÅÊêúÁ¥¢ÂÖ≥ÈîÆËØçÊàñËÆøÈóÆ‰ª§Áâå");try{const s=`${this.baseUrl}/characters/${e}/search/?categories=structure&search=${encodeURIComponent(t)}`,r=await fetch(s,{method:"GET",headers:{Authorization:`Bearer ${a}`,"User-Agent":"EVE Blueprint Calculator"}});if(!r.ok){if(401===r.status)throw new Error("ËÆ§ËØÅÂ§±Ë¥•ÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï");if(403===r.status)throw new Error("Ê≤°ÊúâÊùÉÈôêËÆøÈóÆÂª∫Á≠ëÊêúÁ¥¢");if(404===r.status)return[];throw new Error(`ÊêúÁ¥¢Â§±Ë¥•: ${r.status} ${r.statusText}`)}return(await r.json()).structure||[]}catch(s){if(s instanceof Error)throw s;throw new Error(`ÊêúÁ¥¢Âª∫Á≠ëÊó∂ÂèëÁîüÈîôËØØ: ${s}`)}}async getStructureInfo(e,t){if(!e||!t)throw new Error("Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞ÔºöÂª∫Á≠ëIDÊàñËÆøÈóÆ‰ª§Áâå");try{const s=`${this.baseUrl}/universe/structures/${e}/`,r=await fetch(s,{method:"GET",headers:{Authorization:`Bearer ${t}`,"User-Agent":"EVE Blueprint Calculator"}});if(!r.ok){if(404===r.status)return null;throw new Error(`Ëé∑ÂèñÂª∫Á≠ë‰ø°ÊÅØÂ§±Ë¥•: ${r.status} ${r.statusText}`)}const n=await r.json();let i;try{const{dataService:e}=await j(async()=>{const{dataService:e}=await Promise.resolve().then(()=>b);return{dataService:e}},void 0,import.meta.url),t=e.getEveData(),a=null==t?void 0:t.type_info[n.type_id.toString()];i=(null==a?void 0:a.icon_name)||void 0}catch(a){}return{structure_id:e,name:n.name,type_id:n.type_id,solar_system_id:n.solar_system_id,icon_name:i}}catch(a){if(a instanceof Error)throw a;throw new Error(`Ëé∑ÂèñÂª∫Á≠ë‰ø°ÊÅØÊó∂ÂèëÁîüÈîôËØØ: ${a}`)}}async getStructuresInfo(e,t){const a=[],s=[];for(const n of e){const e=X.getCachedStructureInfo(n);if(e){let t;try{const{dataService:a}=await j(async()=>{const{dataService:e}=await Promise.resolve().then(()=>b);return{dataService:e}},void 0,import.meta.url),s=a.getEveData(),r=null==s?void 0:s.type_info[e.type_id.toString()];t=(null==r?void 0:r.icon_name)||void 0}catch(r){}a.push({structure_id:n,name:e.name,type_id:e.type_id,solar_system_id:0,icon_name:t})}else s.push(n)}if(s.length>0){const e=5;for(let n=0;n<s.length;n+=e){const i=s.slice(n,n+e).map(e=>this.getStructureInfo(e,t));try{const e=await Promise.allSettled(i),t=[];e.forEach(e=>{"fulfilled"===e.status&&e.value&&(a.push(e.value),t.push(e.value))}),t.length>0&&X.cacheStructureInfos(t)}catch(r){}n+e<s.length&&await new Promise(e=>setTimeout(e,100))}}return a}getCachedStructureName(e){return X.getCachedStructureName(e)}getCachedStructureInfo(e){return X.getCachedStructureInfo(e)}};function Z(){const[e,t]=a.useState([]),[s,r]=a.useState(!0),[n,i]=a.useState(null),[c,l]=a.useState(null),[o,u]=a.useState(300),[d,m]=a.useState(!1),[h,p]=a.useState(!1),[y,f]=a.useState(!1),[g,x]=a.useState(null),[S,N]=a.useState(null),[_,I]=a.useState(null),[b,k]=a.useState(()=>{const e=localStorage.getItem("eve-blueprint-settings");if(e)try{const t=JSON.parse(e);return{materialEfficiency:t.materialEfficiency??0,timeEfficiency:t.timeEfficiency??0,complexStructure:t.complexStructure??"none",complexRig:t.complexRig??"none",complexSolarSystem:t.complexSolarSystem??null,complexTax:t.complexTax??0,refineStructure:t.refineStructure??"none",reactionRig:t.reactionRig??"none",refineSolarSystem:t.refineSolarSystem??null,reactionTax:t.reactionTax??0,marketType:t.marketType??"region",marketSelection:t.marketSelection??"10000002",structureMarketId:t.structureMarketId??null,runs:t.runs??1,considerOrderVolume:t.considerOrderVolume??!0}}catch(t){}return{materialEfficiency:0,timeEfficiency:0,complexStructure:"none",complexRig:"none",complexSolarSystem:null,complexTax:0,refineStructure:"none",reactionRig:"none",refineSolarSystem:null,reactionTax:0,marketType:"region",marketSelection:"10000002",structureMarketId:null,runs:1,considerOrderVolume:!0}}),[C,T]=a.useState(""),[D,$]=a.useState(""),[R,M]=a.useState([]),[A,z]=a.useState([]),[L,V]=a.useState(b),[U,J]=a.useState(""),[K,Z]=a.useState([]),[ee,te]=a.useState(!1),[ae,se]=a.useState(null),[re,ne]=a.useState(!1),[ie,ce]=a.useState(null),[le,oe]=a.useState(null);a.useEffect(()=>{ue(),X.cleanExpiredCache()},[]),a.useEffect(()=>{h&&V(b)},[h,b]),a.useEffect(()=>{(async()=>{if("structure"===b.marketType&&b.structureMarketId){const t=X.getCachedStructureInfo(b.structureMarketId);if(t)return void oe(t.name);if(g)try{const e=await Y.getStructureInfo(b.structureMarketId,g);e?(oe(e.name),X.cacheStructureInfo(b.structureMarketId,e.name,e.type_id)):oe(`Âª∫Á≠ë ${b.structureMarketId}`)}catch(e){oe(`Âª∫Á≠ë ${b.structureMarketId}`)}else oe(`Âª∫Á≠ë ${b.structureMarketId}`)}else oe(null)})()},[b.marketType,b.structureMarketId,g]);const ue=async()=>{try{r(!0),i(null),await Promise.all([E.loadEveData(),B.loadConfig(),P.loadData(),O.loadSystemsData(),j(async()=>{const{initializeEveOAuth:e}=await Promise.resolve().then(()=>H);return{initializeEveOAuth:e}},void 0,import.meta.url).then(({initializeEveOAuth:e})=>e())]);const e=E.buildTree();t(e)}catch(e){i(e instanceof Error?e.message:"Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•")}finally{r(!1)}},de=e=>{if(d){const t=e.clientX;t>200&&t<600&&u(t)}},me=()=>{m(!1)},he=()=>{V(b),p(!1)},pe=(e,t,a)=>{x(e),N(t),I(a),f(!1),e&&t&&a?(localStorage.setItem("eve_auth_token",e),localStorage.setItem("eve_auth_refresh_token",t),localStorage.setItem("eve_auth_character",JSON.stringify(a))):(localStorage.removeItem("eve_auth_token"),localStorage.removeItem("eve_auth_refresh_token"),localStorage.removeItem("eve_auth_character"))},ye=async()=>{if(U.trim())if(g&&(null==_?void 0:_.CharacterID)){te(!0),se(null),Z([]);try{const e=await Y.searchStructures(_.CharacterID,U,g);if(0===e.length)return void se("Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÂª∫Á≠ë");const t=await Y.getStructuresInfo(e,g);Z(t),0===t.length&&se("Ëé∑ÂèñÂª∫Á≠ë‰ø°ÊÅØÂ§±Ë¥•")}catch(e){se(e instanceof Error?e.message:"ÊêúÁ¥¢Â§±Ë¥•")}finally{te(!1)}}else se("ËØ∑ÂÖàÁôªÂΩïEVEË¥¶Âè∑");else se("ËØ∑ËæìÂÖ•ÊêúÁ¥¢ÂÖ≥ÈîÆËØç")},fe=async()=>{if(g&&S&&!re)try{ne(!0);const t=await W(g,S,()=>{});if(t.needsRefresh){x(t.accessToken),N(t.refreshToken),localStorage.setItem("eve_auth_token",t.accessToken),localStorage.setItem("eve_auth_refresh_token",t.refreshToken);try{const{getCharacterInfo:e}=await j(async()=>{const{getCharacterInfo:e}=await Promise.resolve().then(()=>H);return{getCharacterInfo:e}},void 0,import.meta.url),a=await e(t.accessToken);I(a),localStorage.setItem("eve_auth_character",JSON.stringify(a))}catch(e){}}}catch(e){}finally{ne(!1)}},ve=()=>{if(g){const e=Q(g);ce(e)}else ce(null)};return a.useEffect(()=>{const e=localStorage.getItem("eve_auth_token"),t=localStorage.getItem("eve_auth_refresh_token"),a=localStorage.getItem("eve_auth_character");if(e&&t&&a)try{const s=JSON.parse(a);x(e),N(t),I(s)}catch(s){localStorage.removeItem("eve_auth_token"),localStorage.removeItem("eve_auth_refresh_token"),localStorage.removeItem("eve_auth_character")}},[]),a.useEffect(()=>{let e=null,t=null,a=null;if("/auth/callback"===window.location.pathname){const s=new URLSearchParams(window.location.search);e=s.get("code"),t=s.get("state"),a=s.get("error")}else if(window.location.hash.includes("#/auth/callback")){const s=new URLSearchParams(window.location.hash.split("?")[1]);e=s.get("code"),t=s.get("state"),a=s.get("error")}if(e||t||a||"/auth/callback"===window.location.pathname||"/EVE_BP_Calc/auth/callback"===window.location.pathname||window.location.hash.includes("#/auth/callback")){if(a){const e=window.location.pathname.includes("/EVE_BP_Calc")?"/EVE_BP_Calc/":"/";return void window.history.replaceState({},document.title,e)}if(e&&t)j(async()=>{const{handleOAuthCallback:e,getCharacterInfo:t}=await Promise.resolve().then(()=>H);return{handleOAuthCallback:e,getCharacterInfo:t}},void 0,import.meta.url).then(({handleOAuthCallback:a,getCharacterInfo:s})=>{a(e,t).then(e=>s(e.access_token).then(t=>{pe(e.access_token,e.refresh_token,t);const a=window.location.pathname.includes("/EVE_BP_Calc")?"/EVE_BP_Calc/":"/";window.history.replaceState({},document.title,a)})).catch(e=>{const t=window.location.pathname.includes("/EVE_BP_Calc")?"/EVE_BP_Calc/":"/";window.history.replaceState({},document.title,t)})});else{const e=window.location.pathname.includes("/EVE_BP_Calc")?"/EVE_BP_Calc/":"/";window.history.replaceState({},document.title,e)}}},[]),a.useEffect(()=>{if(!g||!S)return;ve(),q(g,2)&&fe();const e=setInterval(()=>{ve(),g&&q(g,2)&&!re&&fe()},6e4);return()=>{clearInterval(e)}},[g,S]),a.useEffect(()=>{ve()},[g]),a.useEffect(()=>{if(d)return document.addEventListener("mousemove",de),document.addEventListener("mouseup",me),()=>{document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",me)}},[d]),s?v.jsx("div",{className:"app",children:v.jsxs("div",{className:"loading",children:[v.jsx("div",{className:"loading-spinner"}),v.jsx("div",{className:"loading-text",children:"Âä†ËΩΩ‰∏≠..."})]})}):n?v.jsx("div",{className:"app",children:v.jsxs("div",{className:"error",children:[v.jsx("div",{className:"error-icon",children:"‚ö†Ô∏è"}),v.jsx("div",{className:"error-text",children:n}),v.jsx("button",{className:"error-retry",onClick:ue,children:"ÈáçËØï"})]})}):v.jsxs("div",{className:"app",children:[v.jsxs("div",{className:"app-header",children:[v.jsx("h1",{children:"EVEËìùÂõæËÆ°ÁÆóÂô®"}),v.jsxs("div",{className:"header-actions",children:[g&&_?v.jsx("div",{className:"user-menu",children:v.jsxs("div",{className:"user-info",children:[null!==ie&&v.jsx("div",{className:"token-status",children:re?v.jsx("span",{className:"token-refreshing",children:"[!] Âà∑Êñ∞‰∏≠..."}):ie<=2?v.jsxs("span",{className:"token-expiring",children:["[!] ",ie,"ÂàÜÈíü"]}):v.jsxs("span",{className:"token-valid",children:[ie,"ÂàÜÈíü"]})}),v.jsx("button",{className:"user-avatar-button",onClick:()=>f(!0),title:`${_.CharacterName} - ÁÇπÂáªÊü•ÁúãË¥¶Êà∑‰ø°ÊÅØ`,children:v.jsx("img",{src:`https://images.evetech.net/characters/${_.CharacterID}/portrait?size=32`,alt:_.CharacterName,className:"user-avatar"})})]})}):v.jsx("button",{className:"auth-button",onClick:()=>f(!0),title:"EVEËÆ§ËØÅ",children:v.jsx("img",{src:"./eve_auth.png",alt:"EVEËÆ§ËØÅ"})}),v.jsx("button",{className:"settings-button",onClick:()=>p(!0),title:"ËÆæÁΩÆ",children:"‚öôÔ∏è"})]})]}),v.jsxs("div",{className:"app-content",children:[v.jsxs("div",{className:"sidebar",style:{width:`${o}px`},children:[v.jsx("div",{className:"sidebar-header",children:v.jsx("h2",{children:"Áâ©ÂìÅÁõÆÂΩï"})}),v.jsx("div",{className:"sidebar-content",children:v.jsx(w,{nodes:e,onNodeSelect:e=>{l(e)}})})]}),v.jsx("div",{className:"resize-handle "+(d?"resizing":""),onMouseDown:e=>{m(!0),e.preventDefault()}}),v.jsxs("div",{className:"main-content",children:[v.jsxs("div",{className:"content-header",children:[v.jsx("div",{className:"content-header-main",children:v.jsx("h2",{children:"ËØ¶ÁªÜ‰ø°ÊÅØ"})}),b&&v.jsx("div",{className:"content-header-settings",children:v.jsxs("div",{className:"settings-summary",children:[v.jsxs("div",{className:"settings-row",children:[v.jsxs("div",{className:"settings-item",children:[v.jsx("span",{className:"settings-label",children:"ÊùêÊñôÊïàÁéá:"}),v.jsx("span",{className:"settings-value",children:b.materialEfficiency})]}),v.jsxs("div",{className:"settings-item",children:[v.jsx("span",{className:"settings-label",children:"Êó∂Èó¥ÊïàÁéá:"}),v.jsx("span",{className:"settings-value",children:b.timeEfficiency})]}),v.jsxs("div",{className:"settings-item",children:[v.jsx("span",{className:"settings-label",children:"Â∏ÇÂú∫:"}),v.jsx("span",{className:"settings-value",children:(()=>{if("structure"===b.marketType&&le)return le;if("structure"===b.marketType&&b.structureMarketId)return`Âª∫Á≠ë ${b.structureMarketId}`;return{10000002:"Jita",10000043:"Amarr",10000032:"Dodixie",10000042:"Hek",10000030:"Rens"}[b.marketSelection]||b.marketSelection})()})]})]}),v.jsxs("div",{className:"settings-row",children:[v.jsxs("div",{className:"settings-item",children:[v.jsx("span",{className:"settings-label",children:"Âä†Â∑•Âª∫Á≠ë:"}),v.jsxs("span",{className:"settings-value",children:["none"!==b.complexStructure?b.complexStructure:"Êó†","none"!==b.complexRig&&` + ${b.complexRig.toUpperCase()}`]})]}),v.jsxs("div",{className:"settings-item",children:[v.jsx("span",{className:"settings-label",children:"Âà∂ÈÄ†Âä†Êàê:"}),v.jsx("span",{className:"settings-value",children:(()=>{const e=B.getConfig();if(!e)return"Êó†Êï∞ÊçÆ";let t=1,a=1,s=1,r=1,n=1,i=1,c=1;if("none"!==b.complexStructure){const s=e.structure.complex.find(e=>e.name===b.complexStructure);s&&(t=s.ME,a=s.Cost)}if("none"!==b.complexRig){const t=e["complex-rigs"][b.complexRig];t&&(s=t.ME,r=t.Cost,n=t.hs,i=t.ls,c=t.ns)}let l=1;if(b.complexSolarSystem&&"none"!==b.complexRig){const e=P.getSolarSystemById(b.complexSolarSystem);if(e){const t=e.display_security;l=t>=.5?1-n*(1-s):t>=0?1-i*(1-s):1-c*(1-s)}}const o=a*r,u=e=>{const t=Math.round(1e5*e)/1e5;return t%1==0?t.toString():t.toFixed(5).replace(/\.?0+$/,"")};return`ÊùêÊñô -${u(100*(1-t*("none"!==b.complexRig?l:1)))}%, ÊàêÊú¨ -${u(100*(1-o))}%`})()})]}),b.complexSolarSystem&&v.jsxs("div",{className:"settings-item",children:[v.jsx("span",{className:"settings-label",children:"Âä†Â∑•ÊòüÁ≥ª:"}),v.jsx("span",{className:"settings-value",children:(()=>{const e=P.getDisplayNameWithSecurity(b.complexSolarSystem);return e?v.jsxs(v.Fragment,{children:[v.jsx("span",{className:"security-badge-small",style:{backgroundColor:e.securityColor},children:e.displaySecurity.toFixed(1)}),e.displayName]}):"Êú™Áü•ÊòüÁ≥ª"})()})]}),b.complexSolarSystem&&v.jsxs("div",{className:"settings-item",children:[v.jsx("span",{className:"settings-label",children:"Âà∂ÈÄ†Á≥ªÊï∞:"}),v.jsx("span",{className:"settings-value",children:(()=>{const e=O.getManufacturingCostIndex(b.complexSolarSystem);return null===e?"Êú™Áü•":O.formatCostIndex(e)})()})]}),b.complexTax>0&&v.jsxs("div",{className:"settings-item",children:[v.jsx("span",{className:"settings-label",children:"Âä†Â∑•Á®éÁéá:"}),v.jsxs("span",{className:"settings-value",children:[b.complexTax,"%"]})]})]}),v.jsxs("div",{className:"settings-row",children:[v.jsxs("div",{className:"settings-item",children:[v.jsx("span",{className:"settings-label",children:"ÂèçÂ∫îÂª∫Á≠ë:"}),v.jsxs("span",{className:"settings-value",children:["none"!==b.refineStructure?b.refineStructure:"Êó†","none"!==b.reactionRig&&` + ${b.reactionRig.toUpperCase()}`]})]}),v.jsxs("div",{className:"settings-item",children:[v.jsx("span",{className:"settings-label",children:"ÂèçÂ∫îÂä†Êàê:"}),v.jsx("span",{className:"settings-value",children:(()=>{const e=B.getConfig();if(!e)return"Êó†Êï∞ÊçÆ";let t=1,a=1,s=1,r=1,n=1,i=1,c=1;if("none"!==b.refineStructure){const s=e.structure.refine.find(e=>e.name===b.refineStructure);s&&(t=s.ME,a=s.Cost)}if("none"!==b.reactionRig){const t=e["reaction-rigs"][b.reactionRig];t&&(s=t.ME,r=t.Cost,n=t.hs,i=t.ls,c=t.ns)}let l=1;if(b.refineSolarSystem&&"none"!==b.reactionRig){const e=P.getSolarSystemById(b.refineSolarSystem);if(e){const t=e.display_security;l=t>=.5?1-n*(1-s):t>=0?1-i*(1-s):1-c*(1-s)}}const o=a*r,u=e=>{const t=Math.round(1e5*e)/1e5;return t%1==0?t.toString():t.toFixed(5).replace(/\.?0+$/,"")};return`ÊùêÊñô -${u(100*(1-t*("none"!==b.reactionRig?l:1)))}%, ÊàêÊú¨ -${u(100*(1-o))}%`})()})]}),b.refineSolarSystem&&v.jsxs("div",{className:"settings-item",children:[v.jsx("span",{className:"settings-label",children:"ÂèçÂ∫îÊòüÁ≥ª:"}),v.jsx("span",{className:"settings-value",children:(()=>{const e=P.getDisplayNameWithSecurity(b.refineSolarSystem);return e?v.jsxs(v.Fragment,{children:[v.jsx("span",{className:"security-badge-small",style:{backgroundColor:e.securityColor},children:e.displaySecurity.toFixed(1)}),e.displayName]}):"Êú™Áü•ÊòüÁ≥ª"})()})]}),b.refineSolarSystem&&v.jsxs("div",{className:"settings-item",children:[v.jsx("span",{className:"settings-label",children:"ÂèçÂ∫îÁ≥ªÊï∞:"}),v.jsx("span",{className:"settings-value",children:(()=>{const e=O.getReactionCostIndex(b.refineSolarSystem);return null===e?"Êú™Áü•":O.formatCostIndex(e)})()})]}),b.reactionTax>0&&v.jsxs("div",{className:"settings-item",children:[v.jsx("span",{className:"settings-label",children:"ÂèçÂ∫îÁ®éÁéá:"}),v.jsxs("span",{className:"settings-value",children:[b.reactionTax,"%"]})]})]})]})})]}),v.jsx("div",{className:"content-body",children:v.jsx(F,{selectedNode:c,settings:b,authToken:g})})]})]}),h&&v.jsx("div",{className:"settings-overlay",children:v.jsxs("div",{className:"settings-modal",children:[v.jsxs("div",{className:"settings-header",children:[v.jsx("h2",{children:"ËÆæÁΩÆ"}),v.jsx("button",{className:"settings-close",onClick:he,children:"‚úï"})]}),v.jsxs("div",{className:"settings-layout",children:[v.jsxs("div",{className:"settings-content",children:[v.jsxs("div",{className:"setting-item",children:[v.jsx("label",{children:"ÈªòËÆ§ËìùÂõæÊùêÊñôÊïàÁéá:"}),v.jsx("select",{value:L.materialEfficiency,onChange:e=>V({...L,materialEfficiency:parseInt(e.target.value)}),children:Array.from({length:11},(e,t)=>t).map(e=>v.jsx("option",{value:e,children:e},e))})]}),v.jsxs("div",{className:"setting-item",children:[v.jsx("label",{children:"ÈªòËÆ§ËìùÂõæÊó∂Èó¥ÊïàÁéá:"}),v.jsx("select",{value:L.timeEfficiency,onChange:e=>V({...L,timeEfficiency:parseInt(e.target.value)}),children:Array.from({length:11},(e,t)=>2*t).map(e=>v.jsx("option",{value:e,children:e},e))})]}),v.jsxs("div",{className:"setting-group",children:[v.jsx("h3",{children:"ÈªòËÆ§Âä†Â∑•Âª∫Á≠ë"}),v.jsxs("div",{className:"setting-item",children:[v.jsx("label",{children:"Âª∫Á≠ëÂêçÁß∞:"}),v.jsx("select",{value:L.complexStructure,onChange:e=>V({...L,complexStructure:e.target.value}),children:B.getComplexStructures().map(e=>v.jsx("option",{value:e.value,children:e.name},e.value))})]}),v.jsxs("div",{className:"setting-item",children:[v.jsx("label",{children:"Êèí‰ª∂:"}),v.jsx("select",{value:L.complexRig,onChange:e=>V({...L,complexRig:e.target.value}),children:B.getComplexRigs().map(e=>v.jsx("option",{value:e.value,children:e.name},e.value))})]}),v.jsxs("div",{className:"setting-item",children:[v.jsx("label",{children:"ÊòüÁ≥ª:"}),v.jsxs("div",{className:"solar-system-input",children:[v.jsx("input",{type:"text",placeholder:"ËæìÂÖ•Ëá≥Â∞ë2‰∏™Â≠óÁ¨¶ÊêúÁ¥¢ÊòüÁ≥ª",value:C,onChange:e=>(e=>{if(T(e),e.length>=2){const t=P.searchSolarSystems(e);M(t)}else M([])})(e.target.value)}),R.length>0&&v.jsx("div",{className:"solar-system-results",children:R.map(e=>v.jsxs("div",{className:"solar-system-result-item",onClick:()=>{return t=e.id,V({...L,complexSolarSystem:t}),T(""),void M([]);var t},children:[v.jsx("span",{className:"security-badge",style:{backgroundColor:e.securityColor},children:e.displaySecurity.toFixed(1)}),e.displayName]},e.id))}),L.complexSolarSystem&&v.jsxs("div",{className:"selected-solar-system",children:["Â∑≤ÈÄâÊã©: ",(()=>{const e=P.getDisplayNameWithSecurity(L.complexSolarSystem);return e?v.jsxs(v.Fragment,{children:[v.jsx("span",{className:"security-badge",style:{backgroundColor:e.securityColor},children:e.displaySecurity.toFixed(1)}),e.displayName]}):"Êú™Áü•ÊòüÁ≥ª"})()]})]})]}),v.jsxs("div",{className:"setting-item",children:[v.jsx("label",{children:"ËÆæÊñΩÁ®é:"}),v.jsx("input",{type:"number",min:"0",max:"100",value:L.complexTax,onChange:e=>V({...L,complexTax:Math.min(100,Math.max(0,parseInt(e.target.value)||0))}),placeholder:"0-100"})]})]}),v.jsxs("div",{className:"setting-group",children:[v.jsx("h3",{children:"ÈªòËÆ§ÂèçÂ∫îÂª∫Á≠ë"}),v.jsxs("div",{className:"setting-item",children:[v.jsx("label",{children:"Âª∫Á≠ëÂêçÁß∞:"}),v.jsx("select",{value:L.refineStructure,onChange:e=>V({...L,refineStructure:e.target.value}),children:B.getRefineStructures().map(e=>v.jsx("option",{value:e.value,children:e.name},e.value))})]}),v.jsxs("div",{className:"setting-item",children:[v.jsx("label",{children:"Êèí‰ª∂:"}),v.jsx("select",{value:L.reactionRig,onChange:e=>V({...L,reactionRig:e.target.value}),children:B.getReactionRigs().map(e=>v.jsx("option",{value:e.value,children:e.name},e.value))})]}),v.jsxs("div",{className:"setting-item",children:[v.jsx("label",{children:"ÊòüÁ≥ª:"}),v.jsxs("div",{className:"solar-system-input",children:[v.jsx("input",{type:"text",placeholder:"ËæìÂÖ•Ëá≥Â∞ë2‰∏™Â≠óÁ¨¶ÊêúÁ¥¢ÊòüÁ≥ª",value:D,onChange:e=>(e=>{if($(e),e.length>=2){const t=P.searchSolarSystems(e);z(t)}else z([])})(e.target.value)}),A.length>0&&v.jsx("div",{className:"solar-system-results",children:A.map(e=>v.jsxs("div",{className:"solar-system-result-item",onClick:()=>{return t=e.id,V({...L,refineSolarSystem:t}),$(""),void z([]);var t},children:[v.jsx("span",{className:"security-badge",style:{backgroundColor:e.securityColor},children:e.displaySecurity.toFixed(1)}),e.displayName]},e.id))}),L.refineSolarSystem&&v.jsxs("div",{className:"selected-solar-system",children:["Â∑≤ÈÄâÊã©: ",(()=>{const e=P.getDisplayNameWithSecurity(L.refineSolarSystem);return e?v.jsxs(v.Fragment,{children:[v.jsx("span",{className:"security-badge",style:{backgroundColor:e.securityColor},children:e.displaySecurity.toFixed(1)}),e.displayName]}):"Êú™Áü•ÊòüÁ≥ª"})()]})]})]}),v.jsxs("div",{className:"setting-item",children:[v.jsx("label",{children:"ËÆæÊñΩÁ®é:"}),v.jsx("input",{type:"number",min:"0",max:"100",value:L.reactionTax,onChange:e=>V({...L,reactionTax:Math.min(100,Math.max(0,parseInt(e.target.value)||0))}),placeholder:"0-100"})]})]}),v.jsxs("div",{className:"setting-group",children:[v.jsx("h3",{children:"‰ª∑Ê†ºËÆ°ÁÆóËÆæÁΩÆ"}),v.jsxs("div",{className:"setting-item",children:[v.jsx("label",{children:"ËÄÉËôëËÆ¢ÂçïÊï∞Èáè:"}),v.jsx("input",{type:"checkbox",checked:L.considerOrderVolume,onChange:e=>V({...L,considerOrderVolume:e.target.checked})}),v.jsx("span",{className:"setting-description",children:L.considerOrderVolume?"ÂºÄÂêØÔºöÊåâÂÆûÈôÖËÆ¢ÂçïÂàÜÈÖçËÆ°ÁÆó‰ª∑Ê†ºÔºàÊõ¥ÂáÜÁ°ÆÔºâ":"ÂÖ≥Èó≠Ôºö‰ΩøÁî®ÊúÄ‰Ωé‰ª∑Ê†º√óÈúÄÊ±ÇÈáèËÆ°ÁÆóÔºàÊõ¥Âø´ÈÄüÔºâ"})]})]})]}),v.jsxs("div",{className:"settings-sidebar",children:[v.jsxs("div",{className:"sidebar-content",children:[v.jsx("h3",{children:"Â∏ÇÂú∫ÈÄâÊã©"}),v.jsxs("div",{className:"market-selector",children:[v.jsx("div",{className:"market-option",children:v.jsxs("label",{className:"market-radio-item",children:[v.jsx("input",{type:"radio",name:"sidebarMarketSelection",value:"10000002",checked:"region"===L.marketType&&"10000002"===L.marketSelection,onChange:e=>V({...L,marketType:"region",marketSelection:e.target.value,structureMarketId:null})}),v.jsx("div",{className:"market-option-content",children:v.jsx("div",{className:"market-name",children:"Jita"})})]})}),v.jsx("div",{className:"market-option",children:v.jsxs("label",{className:"market-radio-item",children:[v.jsx("input",{type:"radio",name:"sidebarMarketSelection",value:"10000043",checked:"region"===L.marketType&&"10000043"===L.marketSelection,onChange:e=>V({...L,marketType:"region",marketSelection:e.target.value,structureMarketId:null})}),v.jsx("div",{className:"market-option-content",children:v.jsx("div",{className:"market-name",children:"Amarr"})})]})}),v.jsx("div",{className:"market-option",children:v.jsxs("label",{className:"market-radio-item",children:[v.jsx("input",{type:"radio",name:"sidebarMarketSelection",value:"10000032",checked:"region"===L.marketType&&"10000032"===L.marketSelection,onChange:e=>V({...L,marketType:"region",marketSelection:e.target.value,structureMarketId:null})}),v.jsx("div",{className:"market-option-content",children:v.jsx("div",{className:"market-name",children:"Dodixie"})})]})}),v.jsx("div",{className:"market-option",children:v.jsxs("label",{className:"market-radio-item",children:[v.jsx("input",{type:"radio",name:"sidebarMarketSelection",value:"10000042",checked:"region"===L.marketType&&"10000042"===L.marketSelection,onChange:e=>V({...L,marketType:"region",marketSelection:e.target.value,structureMarketId:null})}),v.jsx("div",{className:"market-option-content",children:v.jsx("div",{className:"market-name",children:"Hek"})})]})}),v.jsx("div",{className:"market-option",children:v.jsxs("label",{className:"market-radio-item",children:[v.jsx("input",{type:"radio",name:"sidebarMarketSelection",value:"10000030",checked:"region"===L.marketType&&"10000030"===L.marketSelection,onChange:e=>V({...L,marketType:"region",marketSelection:e.target.value,structureMarketId:null})}),v.jsx("div",{className:"market-option-content",children:v.jsx("div",{className:"market-name",children:"Rens"})})]})})]})]}),v.jsxs("div",{className:"sidebar-content",style:{marginTop:"20px"},children:[v.jsx("h3",{children:"Â∏ÇÂú∫Âª∫Á≠ëÊêúÁ¥¢"}),v.jsxs("div",{className:"structure-search-section",children:[v.jsxs("div",{className:"structure-search-form",children:[v.jsxs("div",{className:"search-input-wrapper",children:[v.jsx("input",{type:"text",className:"structure-search-input",placeholder:"ËæìÂÖ•Âª∫Á≠ëÂêçÁß∞ÂÖ≥ÈîÆËØç...",value:U,onChange:e=>J(e.target.value),onKeyPress:e=>{"Enter"===e.key&&ye()}}),v.jsx("button",{className:"structure-search-button",onClick:ye,disabled:ee||!g,children:ee?"ÊêúÁ¥¢‰∏≠...":"ÊêúÁ¥¢"})]}),U&&v.jsx("button",{className:"structure-clear-button",onClick:()=>{J(""),Z([]),se(null)},children:"Ê∏ÖÁ©∫"})]}),!g&&v.jsx("div",{className:"structure-search-notice",children:v.jsx("p",{children:"ËØ∑ÂÖàÁôªÂΩïEVEË¥¶Âè∑‰ª•ÊêúÁ¥¢Â∏ÇÂú∫Âª∫Á≠ë"})}),ae&&v.jsx("div",{className:"structure-search-error",children:v.jsxs("p",{children:["[x] ",ae]})}),K.length>0&&v.jsxs("div",{className:"structure-search-results",children:[v.jsxs("div",{className:"structure-results-header",children:[v.jsxs("h4",{children:["ÊêúÁ¥¢ÁªìÊûú (",K.length,")"]}),v.jsx("button",{className:"structure-cache-clear-button",onClick:()=>{X.clearAllCache()},title:"Ê∏ÖÈô§Âª∫Á≠ë‰ø°ÊÅØÁºìÂ≠ò",children:"Ê∏ÖÈô§ÁºìÂ≠ò"})]}),v.jsx("div",{className:"structure-list",children:K.map(e=>v.jsx("div",{className:"structure-item "+("structure"===L.marketType&&L.structureMarketId===e.structure_id?"selected":""),onClick:()=>{return t=e.structure_id,void V({...L,marketType:"structure",structureMarketId:t});var t},children:v.jsxs("div",{className:"structure-item-content",children:[v.jsxs("div",{className:"structure-icon",children:[e.icon_name?v.jsx("img",{src:`./static/icons/${e.icon_name}`,alt:"Âª∫Á≠ëÂõæÊ†á",className:"structure-icon-img",onError:e=>{var t;const a=e.target;a.style.display="none",null==(t=a.nextElementSibling)||t.classList.remove("hidden")}}):null,v.jsx("div",{className:"structure-default-icon "+(e.icon_name?"hidden":""),children:"üè¢"})]}),v.jsx("div",{className:"structure-info",children:v.jsx("div",{className:"structure-name",children:e.name})}),"structure"===L.marketType&&L.structureMarketId===e.structure_id&&v.jsx("div",{className:"structure-selected-indicator",children:"‚úì"})]})},e.structure_id))})]})]})]})]})]}),v.jsxs("div",{className:"settings-actions",children:[v.jsx("button",{className:"settings-button-cancel",onClick:he,children:"ÂèñÊ∂à"}),v.jsx("button",{className:"settings-button-confirm",onClick:()=>{(e=>{k(e);try{localStorage.setItem("eve-blueprint-settings",JSON.stringify(e))}catch(t){}})(L),p(!1)},children:"Á°ÆÂÆö"})]})]})}),v.jsx(G,{isOpen:y,onClose:()=>f(!1),onAuthSuccess:pe,currentToken:g,currentRefreshToken:S,currentCharacter:_})]})}g.createRoot(document.getElementById("root")).render(v.jsx(r.StrictMode,{children:v.jsx(Z,{})}));
